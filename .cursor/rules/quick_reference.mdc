---
alwaysApply: true
---

# AgentFlow è¦ç¯„ç´¢å¼•

> âš ï¸ **AIæŒ‡ç¤º**: ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§å¿…è¦ãªç« ã‚’ç‰¹å®šã—ã€`agentflow_ja.mdc` ã®è©²å½“è¡Œã®ã¿èª­ã¿å–ã‚‹ã€‚

---

## ğŸ“‘ è©³ç´°ç´¢å¼• â†’ agentflow_ja.mdc

### ğŸ¯ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ (L9-36)
- æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯è¡¨: L15-22
- 8å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³: L26-35

### ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€  (L39-86)
- agentflow/ æ§‹é€ : L42-74
- apps/ æ§‹é€ : L76-79
- tests/ æ§‹é€ : L81-84

### ğŸ”§ ã‚³ã‚¢æ©Ÿèƒ½ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« (L89-182)
- **Agentå®šç¾©3æ–¹å¼**: L91-128
  - @agent ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿: L94-109
  - create_flow: L111-119
  - AgentBlock: L121-128
- **LLM Provider**: L130-144
- **Skills ã‚·ã‚¹ãƒ†ãƒ **: L146-156
- **ãƒãƒ«ãƒAgentå”èª¿**: L158-181
  - AgentCoordinator: L164-168
  - SupervisorCoordinator: L171-180

### ğŸ“ ã‚³ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«è¦ç¯„ (L185-277)
- **å‘½åè¦å‰‡**: L187-208
  - ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«: snake_case
  - ã‚¯ãƒ©ã‚¹: PascalCase
  - é–¢æ•°/å¤‰æ•°: snake_case
  - å®šæ•°: UPPER_SNAKE_CASE
  - ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ: _prefix
- **å‹ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³**: L210-227 (100%ã‚«ãƒãƒ¬ãƒƒã‚¸å¿…é ˆ)
- **Docstring**: L229-258 (Googleã‚¹ã‚¿ã‚¤ãƒ«)
- **ã‚¤ãƒ³ãƒãƒ¼ãƒˆé †åº**: L260-276 (æ¨™æº–â†’ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£â†’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ)

### ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆåŸå‰‡ (L280-355)
- **SOLIDåŸå‰‡**: L282-302
  - S: å˜ä¸€è²¬ä»»
  - O: é–‹é–‰åŸå‰‡ (Protocol)
  - D: ä¾å­˜æ€§é€†è»¢
- **éåŒæœŸå„ªå…ˆ**: L304-318 (async/awaitå¿…é ˆ)
- **ä¾å­˜æ€§æ³¨å…¥**: L320-333
- **Pydanticãƒ‡ãƒ¼ã‚¿æ¤œè¨¼**: L335-354

### ğŸš¨ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è¦ç¯„ (L358-407)
- **ä¾‹å¤–éšå±¤å®šç¾©**: L360-381
- **ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹**: L383-407
  - ç‰¹å®šä¾‹å¤–ã‚­ãƒ£ãƒƒãƒ: L386-394
  - raise from: L402-406

### ğŸ§ª ãƒ†ã‚¹ãƒˆè¦ç¯„ (L411-483)
- **ã‚«ãƒãƒ¬ãƒƒã‚¸è¦ä»¶**: L413-419 (å˜ä½“â‰¥80%, çµ±åˆ, E2E)
- **ãƒ†ã‚¹ãƒˆæ§‹é€ **: L421-454 (pytest, fixture)
- **å¤–éƒ¨ä¾å­˜ãƒ¢ãƒƒã‚¯**: L456-469 (AsyncMock)
- **ãƒ†ã‚¹ãƒˆãƒãƒ¼ã‚«ãƒ¼**: L471-483 (unit, integration, e2e, slow)

### ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ç¯„ (L487-530)
- **ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ç¦æ­¢**: L489-509 (ç’°å¢ƒå¤‰æ•°, pydantic-settings)
- **å…¥åŠ›æ¤œè¨¼**: L511-520 (Pydantic)
- **ãƒ­ã‚°ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: L522-530 (ãƒã‚¹ã‚¯å‡¦ç†)

### âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ– (L534-570)
- **ä¸¦è¡Œå®Ÿè¡Œ**: L536-550 (asyncio.gather, Semaphore)
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥**: L552-560 (lru_cache)
- **ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ¼ãƒ«**: L562-570 (httpx)

### ğŸ› ï¸ ãƒ„ãƒ¼ãƒ«è¨­å®š (L574-611)
- **Ruff**: L576-589 (line-length=100, select rules)
- **Mypy**: L591-599 (strict=true)
- **Pytest**: L601-611 (asyncio_mode=auto, covâ‰¥80%)

### âŒ ç¦æ­¢äº‹é … (L615-627)
```
print() â†’ logging
Any â†’ å…·ä½“å‹
type: ignore â†’ å‹ä¿®æ­£
def foo(x=[]) â†’ x: list | None = None
ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ â†’ ç’°å¢ƒå¤‰æ•°
--no-verify â†’ ç¦æ­¢
ãƒ†ã‚¹ãƒˆç„¡åŠ¹åŒ– â†’ ç¦æ­¢
except Exception â†’ ç‰¹å®šä¾‹å¤–
```

### âœ… ã‚³ãƒŸãƒƒãƒˆå‰ãƒã‚§ãƒƒã‚¯ (L630-648)
```bash
ruff format . && ruff check . && mypy . && pytest
```

### ğŸ“š AIãŒã‚ˆãçŠ¯ã™é–“é•ã„ (L652-709)
- **async/awaitå¿˜ã‚Œ**: L654-665
- **å¯å¤‰ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°**: L667-681
- **ãƒªã‚½ãƒ¼ã‚¹é–‰ã˜å¿˜ã‚Œ**: L683-696
- **å¾ªç’°ã‚¤ãƒ³ãƒãƒ¼ãƒˆ**: L698-709 (TYPE_CHECKINGä½¿ç”¨)

### ğŸ”„ é–‹ç™ºãƒ•ãƒ­ãƒ¼ (L713-747)
- **æ©Ÿèƒ½é–‹ç™ºãƒ•ãƒ­ãƒ¼**: L715-725 (TDD: Redâ†’Greenâ†’Refactor)
- **ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: L727-737 (feat/fix/docs/style/refactor/test/chore)
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†**: L739-747 (SemVer)

### ğŸ§  èªçŸ¥ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ (L751-808)
- **ReAct**: L761-772 (æ€è€ƒâ†’è¡Œå‹•â†’è¦³å¯Ÿ)
- **è¨ˆç”»å‹**: L774-778 (PlannerAgent)
- **è‡ªå·±åçœ**: L780-786 (ReviewAgent)
- **HITL**: L788-796 (interrupt/approval)

### ğŸ”„ æ¥­ç•Œæ¯”è¼ƒã¨æ‹¡å¼µ (L810-896)
- **ä¸»è¦ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯æ¯”è¼ƒ**: L814-822
- **AgentFlow ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³**: L826-858
- **æ©Ÿèƒ½æ¯”è¼ƒè¡¨**: L860-871
- **å°†æ¥ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—**: L875-894

---

## ğŸš€ ã‚ˆãä½¿ã†ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆã‚³ãƒ”ãƒšç”¨ï¼‰

### Agentå®šç¾©ï¼ˆ@agent ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ï¼‰
```python
from agentflow import agent, tool, AgentClient

@agent
class MyAgent:
    system_prompt = "..."
    skills = ["chatbot"]
    
    @tool
    def my_tool(self, arg: str) -> str: ...

result = await AgentClient.get("MyAgent").invoke({...})
```

### LLMå‘¼ã³å‡ºã—
```python
from agentflow.providers import get_llm
llm = get_llm()
response = await llm.chat([{"role": "user", "content": "..."}])
```

### ãƒãƒ«ãƒAgent
```python
from agentflow import create_flow
flow = create_flow(agents=[A(), B()], pattern="sequential")
result = await flow.run({...})
```

### è¨ˆç”»å‹Agentï¼ˆPlan-and-Executeï¼‰
```python
from agentflow import PlannerAgent, PlanExecutor

planner = PlannerAgent()
plan = await planner.create_plan(goal="Webã‚¢ãƒ—ãƒªæ§‹ç¯‰")
executor = PlanExecutor(agents={"dev": DevAgent(), "test": TestAgent()})
result = await executor.execute(plan)
```

### HITLï¼ˆHuman-in-the-Loopï¼‰
```python
from agentflow import interrupt, ApprovalRequest

response = await interrupt(ApprovalRequest(action="delete", reason="ç¢ºèª"))
if response.approved:
    await do_action()
```

---

## ğŸ“¦ é‡è¦ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

```python
# åŸºæœ¬API
from agentflow import agent, tool, AgentClient, create_flow
from agentflow.providers import get_llm

# ã‚³ã‚¢
from agentflow.core.agent_block import AgentBlock
from agentflow.core.exceptions import AgentFlowError

# ãƒ‘ã‚¿ãƒ¼ãƒ³
from agentflow.patterns.multi_agent import AgentCoordinator, SharedContext
from agentflow.patterns.supervisor import SupervisorCoordinator

# è¨ˆç”»å‹ãƒ»HITL
from agentflow import (
    PlannerAgent, PlanExecutor, Plan, Step,
    interrupt, ApprovalRequest, ApprovalResponse
)
```

---

## ğŸ—‚ï¸ ä¾‹å¤–éšå±¤

```
AgentFlowError
â”œâ”€â”€ WorkflowError
â”‚   â”œâ”€â”€ WorkflowNotFoundError
â”‚   â””â”€â”€ WorkflowExecutionError
â”œâ”€â”€ ProtocolError
â”‚   â”œâ”€â”€ ProtocolNotSupportedError
â”‚   â””â”€â”€ ProtocolAdapterError
â”œâ”€â”€ AgentBlockError
â”‚   â”œâ”€â”€ AgentBlockNotFoundError
â”‚   â””â”€â”€ AgentBlockValidationError
â””â”€â”€ ConfigurationError
```

---

## ğŸ”§ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| é …ç›® | æŠ€è¡“ |
|------|------|
| è¨€èª | Python 3.13+ |
| Linter | Ruff (line-length=100) |
| å‹ãƒã‚§ãƒƒã‚¯ | Mypy (strict) |
| ãƒ†ã‚¹ãƒˆ | Pytest (asyncio, covâ‰¥80%) |
| ãƒ“ãƒ«ãƒ‰ | Hatch |

---

**ğŸ“– è©³ç´°ã‚³ãƒ¼ãƒ‰ä¾‹ãŒå¿…è¦ â†’ `agentflow_ja.mdc` ã®è©²å½“è¡Œã‚’ `read_file` ã§å–å¾—**
