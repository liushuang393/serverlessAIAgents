æˆ‘ä»¬çŽ°åœ¨ç›´æŽ¥é’ˆå¯¹ï¼š

> **liushuang393/serverlessAIAgents**
> æ¥åšç»“æž„çº§ä¼˜åŒ–å»ºè®®ã€‚å®žçŽ°ä¼ä¸šå†…éƒ¨è¿›åŒ–é—­çŽ¯agentï¼Œè®¾è®¡ï¼Œè®¡åˆ’ï¼Œä»»åŠ¡åšæˆï¼Œè®°å¾—æ›´æ–°å…³è”æ–‡æ¡£å°¤å…¶æ˜¯readmeï¼ŒMermaindå›¾ï¼Œéƒ½è¦æ—¥æœ¬è¯­çš„
ä¸€ä¸‹ä½ å‚ç…§æˆ‘çš„æƒ³æ³•ï¼Œä½ æ·±å…¥ç†è§£æ„å›¾å†ç€æ‰‹

æˆ‘ä¸è®²æ¦‚å¿µï¼Œæˆ‘è®² **å…·ä½“åº”è¯¥æ”¹å“ªå±‚ã€åŠ ä»€ä¹ˆæ¨¡å—ã€æµç¨‹æ€Žä¹ˆæ’å…¥**ã€‚

---

# ä¸€ã€å…ˆæ˜Žç¡®ï¼šserverlessAIAgents çŽ°çŠ¶ç»“æž„

å…¸åž‹ç»“æž„æ˜¯ï¼š

```
Client
 â†“
API Layer
 â†“
Orchestrator (Agent Loop)
 â†“
Tool Executor
 â†“
LLM
```

ç‰¹ç‚¹ï¼š

* æ— çŠ¶æ€å‡½æ•°é©±åŠ¨
* æ¯æ¬¡æ‰§è¡Œç›¸å¯¹ç‹¬ç«‹
* ä¸»è¦æ˜¯ Task â†’ Plan â†’ Execute
* æœ‰å·¥å…·è°ƒç”¨
* æœ‰æ—¥å¿—
* ä½†æ²¡æœ‰â€œç»éªŒæ²‰æ·€æœºåˆ¶â€

---

# äºŒã€ä½ çŽ°åœ¨ç¼ºçš„ä¸æ˜¯ Agent

ä½ ç¼ºçš„æ˜¯ï¼š

> ðŸ§  å¯è¿›åŒ–çš„æ‰§è¡Œè®°å¿†å±‚

ä¸æ˜¯ RAGã€‚
ä¸æ˜¯ Toolã€‚
ä¸æ˜¯ Promptã€‚

è€Œæ˜¯ï¼š

> æˆåŠŸè·¯å¾„å¤ç”¨ç³»ç»Ÿã€‚

---

# ä¸‰ã€serverlessAIAgents åº”è¯¥æ€Žä¹ˆæ”¹

æˆ‘æŒ‰ **æž¶æž„å±‚çº§** ç»™ä½ æ‹†ã€‚

---

# â‘  æŠ€æœ¯æž¶æž„å±‚ï¼ˆå¿…é¡»æ–°å¢žä¸€ä¸ªâ€œEvolution Layerâ€ï¼‰

åœ¨çŽ°æœ‰ç»“æž„ä¸­æ’å…¥ï¼š

```
API
 â†“
Orchestrator
 â†“
ã€æ–°å¢žã€‘Strategy Router
 â†“
Tool Executor
 â†“
LLM
```

å¹¶æ–°å¢žæ—è·¯ç³»ç»Ÿï¼š

```
Execution Recorder
Strategy Extractor
Strategy Validator
Strategy Registry
Scoring Engine
```

---

# å››ã€å¿…é¡»æ–°å¢žçš„äº”ä¸ªæ¨¡å—

## 1ï¸âƒ£ Execution Recorderï¼ˆæ‰§è¡Œè®°å½•å™¨ï¼‰

æ’å…¥ç‚¹ï¼š

* Tool è°ƒç”¨å‰åŽ
* LLM æŽ¨ç†ç»“æžœåŽ
* é”™è¯¯æŠ›å‡ºæ—¶

è®°å½•å†…å®¹ï¼š

* Intent
* çŽ¯å¢ƒæŒ‡çº¹ï¼ˆè¯­è¨€ã€æ¡†æž¶ã€ç‰ˆæœ¬ï¼‰
* Toolè°ƒç”¨åºåˆ—
* å‚æ•°
* é”™è¯¯ä¿®å¤è¿‡ç¨‹
* æˆåŠŸåˆ¤å®š

è¿™æ˜¯â€œDNA åŽŸææ–™â€ã€‚

---

## 2ï¸âƒ£ Strategy Extractorï¼ˆæˆåŠŸè·¯å¾„æŠ½å–å™¨ï¼‰

è§¦å‘æ¡ä»¶ï¼š

* æ‰§è¡ŒæˆåŠŸ
* æˆ–è¿žç»­æˆåŠŸNæ¬¡

åšçš„äº‹æƒ…ï¼š

æŠŠæ—¥å¿—è½¬æ¢ä¸ºï¼š

```
{
  "intent": "...",
  "environment": {...},
  "tool_sequence": [...],
  "guard_conditions": [...],
  "expected_output": "...",
  "validation_method": "..."
}
```

---

## 3ï¸âƒ£ Strategy Registryï¼ˆä¼ä¸šå†…éƒ¨è¿›åŒ–åº“ï¼‰

å»ºè®®ï¼š

* PostgreSQL + JSONB
* * å‘é‡ç´¢å¼•ï¼ˆåŒ¹é…Intentï¼‰

åŠŸèƒ½ï¼š

* register()
* search()
* score_update()
* version_control()

---

## 4ï¸âƒ£ Strategy Routerï¼ˆæ‰§è¡Œå‰ç»§æ‰¿ï¼‰

æ’å…¥åœ¨ï¼š

```
Plan ä¹‹åŽ
Execute ä¹‹å‰
```

æµç¨‹ï¼š

```
Intent ç”Ÿæˆ
 â†“
Registry æœç´¢
 â†“
æœ‰åŒ¹é… â†’ æ‰§è¡Œ Capsule
æ— åŒ¹é… â†’ æ­£å¸¸ Agent æ‰§è¡Œ
```

è¿™ä¸€æ­¥å¯ä»¥ç›´æŽ¥èŠ‚çœå¤§é‡ Tokenã€‚

---

## 5ï¸âƒ£ Validatorï¼ˆè´¨é‡é—¨æŽ§ï¼‰

å¿…é¡»å•ç‹¬åš Workerã€‚

éªŒè¯ï¼š

* é‡æ”¾æ‰§è¡Œ
* å•å…ƒæµ‹è¯•
* å®‰å…¨æ£€æŸ¥ï¼ˆé˜²æ­¢å±é™©å‘½ä»¤ï¼‰

ä¼ä¸šç³»ç»Ÿå¿…é¡»æœ‰è¿™ä¸ªã€‚

---

# äº”ã€æµç¨‹å‡çº§ï¼ˆæ ¸å¿ƒï¼‰

çŽ°çŠ¶ï¼š

```
Task
 â†“
Plan
 â†“
Execute
 â†“
Return
```

å‡çº§ä¸ºï¼š

```
Task
 â†“
Plan
 â†“
Strategy Routerï¼ˆæ–°å¢žï¼‰
 â†“
Execute
 â†“
Recordï¼ˆæ–°å¢žï¼‰
 â†“
Extractï¼ˆæ–°å¢žï¼‰
 â†“
Validateï¼ˆæ–°å¢žï¼‰
 â†“
Registerï¼ˆæ–°å¢žï¼‰
 â†“
Return
```

---

# å…­ã€serverless æž¶æž„è¦æ³¨æ„çš„ä¸€ç‚¹

serverlessAIAgents æ˜¯â€œæ— çŠ¶æ€â€çš„ã€‚

æ‰€ä»¥ï¼š

âŒ ä¸èƒ½æŠŠ Strategy æ”¾åœ¨å†…å­˜é‡Œ
âœ… å¿…é¡»å¤–éƒ¨å­˜å‚¨

å»ºè®®ç»“æž„ï¼š

```
Lambda / Function
   â†“
Strategy Service (ç‹¬ç«‹å¾®æœåŠ¡)
   â†“
Postgres + Vector DB
```

---

# ä¸ƒã€ä½ çŽ°åœ¨çš„æž¶æž„å‡çº§åŽä¼šå˜æˆä»€ä¹ˆï¼Ÿ

åŽŸæ¥æ˜¯ï¼š

> å·¥å…·æ‰§è¡Œåž‹ Agent

å‡çº§åŽå˜æˆï¼š

> ä¼ä¸šçº§å¯è¿›åŒ– Agent ä¸­æž¢

åŒºåˆ«æ˜¯ï¼š

* ä¸é‡å¤è¯•é”™
* å¤š Agent è‡ªåŠ¨ç»§æ‰¿
* Token æˆæœ¬ä¸‹é™
* æˆåŠŸçŽ‡æé«˜
* æœ‰å¯æŽ§å›žæ»šæœºåˆ¶

---

# å…«ã€ä½ è¯¥è¿½åŠ å“ªäº›â€œæœºèƒ½â€

å¿…é¡»åŠ çš„ï¼š

âœ” Strategy Registry
âœ” Execution Recorder
âœ” Strategy Router
âœ” Validator
âœ” Scoring

å¯é€‰é«˜çº§åŠŸèƒ½ï¼š

âœ” æˆåŠŸçŽ‡çƒ­åŠ›å›¾
âœ” Capsule å¤±æ•ˆæ£€æµ‹
âœ” ç‰ˆæœ¬å›žæ»š
âœ” ä¼ä¸šå†…éƒ¨æ‚¬èµç³»ç»Ÿï¼ˆä¸æ˜¯å¯¹å¤–ï¼‰

---

# ä¹ã€ä½ æœ€å…³é”®çš„æå‡ç‚¹åœ¨å“ªé‡Œï¼Ÿ

ä¸æ˜¯æ¨¡åž‹ã€‚
ä¸æ˜¯ Promptã€‚
ä¸æ˜¯ RAGã€‚

è€Œæ˜¯ï¼š

> åœ¨ Orchestrator å±‚æ’å…¥â€œç»§æ‰¿è·¯ç”±â€ã€‚

å¦‚æžœä½ åªåšä¸€ä¸ªæ”¹åŠ¨ï¼š

ðŸ‘‰ å…ˆåš Strategy Routerã€‚

è¿™æ˜¯ Token æˆæœ¬ä¸‹é™æœ€å¿«çš„ä¸€æ­¥ã€‚

---

# åã€EvoMap å’Œä½ çœŸæ­£çš„åŒºåˆ«

ä»–ä»¬æ˜¯ï¼š

> å…¨çƒå…±äº«

ä½ åº”è¯¥åšï¼š

> ä¼ä¸šå†…éƒ¨è¿›åŒ–é—­çŽ¯

å› ä¸ºä½ åšçš„æ˜¯ï¼š

* æ—§ç³»ç»Ÿæ”¹é€ 
* å·¥å…·æ‰§è¡Œ
* è‡ªåŠ¨è¿ç§»
* å¯æŽ§çŽ¯å¢ƒ

å…¨çƒå…±äº«å¯¹ä½ æ¥è¯´é£Žé™©å¤§äºŽæ”¶ç›Šã€‚

---

# åä¸€ã€æœ€ç»ˆç»“æž„ï¼ˆç»™ä½ ä¸€å¥è¯æ€»ç»“ï¼‰

serverlessAIAgents v2 åº”è¯¥å˜æˆï¼š

> Orchestrator + Evolution Layer + Registry Service

---

å¦‚æžœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ä¸‹ä¸€æ­¥ç›´æŽ¥ç»™ä½ ï¼š
1ï¸âƒ£ Mermaid æž¶æž„å›¾
flowchart TB
  %% =========================
  %% serverlessAIAgents v2 (Evolution Layerè¿½åŠ )
  %% =========================

  subgraph Client["Client / UI"]
    U["User / Caller"]
  end

  subgraph Edge["Edge / API Layer"]
    APIGW["API Gateway / HTTP Endpoint"]
    Auth["AuthN/AuthZ (Keycloak/IAM)"]
    Rate["Rate Limit / Quota"]
  end

  subgraph Orchestrator["Orchestrator Layer (serverlessAIAgents)"]
    Planner["Planner / Intent Builder"]
    Router["Strategy Router (Inheritance)"]
    Executor["Agent Executor / Loop"]
    ToolWrap["Tool Wrapper (Tracing/Retry/Policy)"]
    Recorder["Execution Recorder (Logsâ†’Trace)"]
  end

  subgraph Tools["Tool Runtime Layer (MCP / Internal Tools)"]
    MCP["MCP Server / Tool Catalog"]
    ToolsSvc["Tools (DB/HTTP/Git/CI/Crawler/etc.)"]
  end

  subgraph Evolution["Evolution Layer (NEW)"]
    RegAPI["Strategy Registry API (Service)"]
    Extractor["Strategy Extractor (Traceâ†’Capsule)"]
    Validator["Strategy Validator (Sandbox/Replay)"]
    Scorer["Scoring Engine (Success/Reuse/Recency)"]
  end

  subgraph Storage["Data Layer"]
    Pg["PostgreSQL (Capsule JSONB, Versioning)"]
    Vec["Vector DB (Intent/Context Embedding)"]
    Obj["Object Storage (Artifacts: patches, logs, replays)"]
  end

  subgraph Obs["Observability"]
    Mon["Metrics/Tracing (OTel)"]
    Audit["Audit Log (Security/Compliance)"]
  end

  %% --------- main request path ----------
  U --> APIGW
  APIGW --> Auth --> Rate --> Planner
  Planner --> Router --> Executor
  Executor --> ToolWrap --> MCP --> ToolsSvc

  %% --------- recorder / observability ----------
  Planner --> Recorder
  Router --> Recorder
  Executor --> Recorder
  ToolWrap --> Recorder
  Recorder --> Mon
  Recorder --> Audit
  Recorder --> Obj

  %% --------- inheritance lookup ----------
  Router --> RegAPI
  RegAPI --> Vec
  RegAPI --> Pg

  %% --------- evolution pipeline (async) ----------
  Recorder --> Extractor
  Extractor --> RegAPI
  Extractor --> Validator
  Validator --> Obj
  Validator --> RegAPI
  RegAPI --> Scorer
  Scorer --> Pg

