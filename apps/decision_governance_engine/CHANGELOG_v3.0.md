# Decision Governance Engine v3.0 変更履歴

## 概要

v3.0 では「思考の圧縮率向上」をテーマに、道・法・術・器の各層を根本から改善しました。

**核心課題**: 
- フレームワーク先行型の設計 → 構造は正しいが、思考の圧縮率が低い
- テンプレート的な出力 → 「誰が見ても納得せざるを得ない一刀」が出ていない

**改善方針**:
- 道層: 問題の「存在理由」を追問する
- 法層: 「推奨」ではなく「約束（禁止事項）」を定義する
- 術層: 「教科書」ではなく「文脈特化」を明確にする
- 器層: 「抽象化」ではなく「具体名詞」を列挙する

---

## 🔴 根本課題と改善内容

### 道層（DaoAgent）

**Before（問題）**:
```
問題タイプ: STRATEGY_DIRECTION
本質: 「中長期的な方向性の決定」
```
→ これは本質ではなく「カテゴリ」。経営会議の議題であって、問題の存在理由ではない。

**After（改善）**:
```
問題の本質的性質: CONSTRAINT_DRIVEN
本質導出:
  - 表面的問題: 国際リアルタイム音声会議システムを構築したい
  - 一段深い理由: 既存のグローバルサービスでは対応できない
  - 根本制約: 法規制・データ主権要件を満たせない
  - 本質の一文: 「既存の標準解が自社の固有制約を満たせない」

既存代替手段:
  - Zoom: データ主権要件を満たせない（中国/EUの規制）
  - Teams: 自社システムとの統合が困難
```

**新フィールド**:
| フィールド | 説明 |
|-----------|------|
| `problem_nature` | 問題の本質的性質（CONSTRAINT_DRIVEN等） |
| `essence_derivation` | 本質導出プロセス（思考の可視化） |
| `existing_alternatives` | 既存代替手段とそれが使えない理由 |

---

### 法層（FaAgent）

**Before（問題）**:
```
推奨パス:
  - A: 段階投資（75%）
  - B: 全力投入（50%）
```
→ これは「選択肢列挙」であり、戦略ではない。何を「絶対にしてはいけないか」が不明。

**After（改善）**:
```
戦略的禁止事項:
  - ⛔ 独自音声技術の開発は禁止
    理由: 標準準拠が長期的な保守性と互換性を確保
    違反結果: エコシステムからの孤立、保守コスト増大

差別化軸:
  - 勝負する軸: 法規制対応能力
  - 勝負しない軸: 音声品質（そこでは勝負しない）

既存解が使えない理由:
  既存のZoomは当社のデータ主権要件を満たせない
```

**新フィールド**:
| フィールド | 説明 |
|-----------|------|
| `strategic_prohibitions` | 戦略的禁止事項（絶対にやってはいけないこと） |
| `differentiation_axis` | 差別化軸（どこで勝負するか/しないか） |
| `why_existing_fails` | 既存解が使えない理由のサマリー |

---

### 術層（ShuAgent）

**Before（問題）**:
```
フェーズ:
  1. 準備・計画（2週間）
  2. 実行・開発（2ヶ月）
  3. 検証・評価（1ヶ月）
  4. 判断・次ステップ（2週間）
```
→ これは「教科書」。どの企業にも当てはまる。文脈固有の行動がない。

**After（改善）**:
```
切り捨てリスト（最初の30日間でやらないこと）:
  - スコープクリープ（範囲拡大）
  - 並行作業による分散
  - 音声品質の最適化（差別化軸ではない）

文脈特化行動:
  - WebRTC SFUベンダー3社の制約比較
    なぜ: この文脈固有の調査が必要
    期待出力: ベンダー比較表
  - 中国-EU間レイテンシ実測
    なぜ: 規制対応能力の検証
    期待出力: レイテンシ測定レポート

単一検証ポイント（PoCで絶対に検証すべき1点）:
  - 検証対象: 中国からのレイテンシが200ms以下か
  - 成功基準: 95%タイルで200ms以下
  - 失敗時: ピボットまたは撤退の判断会議

撤退基準:
  - チェックポイント: 30日後
  - 撤退トリガー: 検証ポイントが成功基準を50%以上下回る
  - 撤退時行動: プロジェクト中断、振り返りレポート作成
```

**新フィールド**:
| フィールド | 説明 |
|-----------|------|
| `cut_list` | 最初の30日間で明示的に「やらない」こと |
| `context_specific_actions` | この問題固有の行動（教科書にない行動） |
| `single_validation_point` | PoCで絶対に検証すべき1点 |
| `exit_criteria` | 撤退基準（どこで止めるか） |

---

### 器層（QiAgent）

**Before（問題）**:
```
実装要素:
  - コアシステム: Python / FastAPI
  - フロントエンド: React / TypeScript
  - インフラ: AWS / Docker
```
→ これは「汎用技術」。どの問題にも当てはまる。ドメイン固有の技術が見えていない。

**After（改善）**:
```
ドメイン固有技術:
  - WebRTC（プロトコル）: ブラウザベースのリアルタイム通信に必須
  - mediasoup SFU（サーバー）: 多人数会議のメディア配信
  - TURN/STUN（NAT越え）: ファイアウォール越えの接続確立
  - Opus（コーデック）: 低遅延音声圧縮

規制対応事項:
  - EU / GDPR: 個人データの域外移転制限
    実装影響: EUリージョンでのデータ処理・保存が必要
  - 中国 / サイバーセキュリティ法: 重要データの国内保存義務
    実装影響: 中国国内のデータセンター設置が必要

地理的考慮事項:
  - アジア太平洋: 200ms以下、東京・シンガポールPoP
  - 欧州: 150ms以下、フランクフルト・ロンドン
  - 北米: 100ms以下、バージニア・オレゴン
```

**新フィールド**:
| フィールド | 説明 |
|-----------|------|
| `domain_technologies` | ドメイン固有技術（具体名詞必須） |
| `regulatory_considerations` | 規制対応事項（地域別） |
| `geographic_considerations` | 地理的考慮事項（レイテンシ・PoP） |

---

## 📊 ExecutiveSummary の強化

v3.0では、エグゼクティブサマリーに以下のフィールドを追加:

| フィールド | 説明 |
|-----------|------|
| `essence_statement` | 問題の本質（道層の結論） |
| `strategic_prohibition_summary` | 最も重要な禁止事項（法層の結論） |
| `exit_criteria_summary` | 撤退基準（術層の結論） |

---

## 🧪 検証強化

各Agentの`validate_output`メソッドで以下を検証:

- **DaoAgent**: テンプレート的な本質を警告
- **FaAgent**: 戦略的禁止事項・差別化軸の欠落を警告
- **ShuAgent**: 切り捨てリスト・撤退基準の欠落を警告
- **QiAgent**: ドメイン固有技術の欠落を警告

---

## 📁 変更ファイル一覧

### スキーマ
- `schemas/agent_schemas.py` - 新フィールド追加（ProblemNatureType, EssenceDerivation等）
- `schemas/output_schemas.py` - ExecutiveSummary強化

### Agents
- `agents/dao_agent.py` - 制約主導型分析・本質導出プロセス追加
- `agents/fa_agent.py` - 戦略的禁止事項・差別化軸追加
- `agents/shu_agent.py` - 文脈特化行動・撤退基準追加
- `agents/qi_agent.py` - ドメイン固有技術・規制対応追加

### ワークフロー
- `workflow.py` - レポート生成ロジック更新

---

## 🎯 使用例

### v3.0 での改善された出力例

**入力**:
```
国際企業が利用できる国際リアルタイム音声会議システムを構築したい
```

**道層の出力**:
```json
{
  "problem_nature": "CONSTRAINT_DRIVEN",
  "essence_derivation": {
    "surface_problem": "国際音声会議システムを構築したい",
    "underlying_why": "既存のグローバルサービスでは対応できない",
    "root_constraint": "法規制・データ主権要件を満たせない",
    "essence_statement": "既存の標準解が自社の固有制約を満たせない"
  },
  "existing_alternatives": [
    {
      "name": "Zoom",
      "why_not_viable": "中国/EUのデータ主権要件を満たせない",
      "specific_constraint": "法規制の要件を満たせない可能性"
    }
  ]
}
```

**法層の出力**:
```json
{
  "strategic_prohibitions": [
    {
      "prohibition": "独自音声技術の開発は禁止",
      "rationale": "WebRTC標準準拠が長期的な保守性と互換性を確保",
      "violation_consequence": "エコシステムからの孤立、保守コスト増大"
    }
  ],
  "differentiation_axis": {
    "axis_name": "法規制対応能力",
    "why_this_axis": "規制対応が本質的な課題であり、ここでの優位性が競合との差別化になる",
    "not_this_axis": "音声品質（ここでは勝負しない）"
  }
}
```

---

## 🔄 後方互換性

v3.0は後方互換性を維持しています:
- 新フィールドはすべてオプショナル（`default_factory`または`default=None`）
- 既存のテスト・クライアントは影響を受けない
- 検証は警告レベルで、厳格な拒否はしない（段階的移行）

---

## 📝 まとめ

v3.0の核心は以下の一文に集約されます:

> **真の提升は機能追加ではなく、「道層で多停2分」して、一句話を「非これ不可」まで磨くこと。**

フレームワークは手段であり、目的ではありません。
道・法・術・器の各層で「本質を削り出す力」を強化しました。

