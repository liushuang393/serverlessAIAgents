# FAQ UI/Stream Postmortem (2026-02-28)

## 対象
- SSE 進捗表示が実行実態と乖離していた問題
- セッションタイトル 17 文字制約の不徹底
- 入力欄下ステータス行の灰色固定・意味不明問題

## 根因
1. 進捗を固定パーセンテージで実装し、実行フェーズ由来のイベント設計が欠けていた。
2. タイトル制約を表示層だけで担保し、サーバー側での強制ルールが欠けていた。
3. ステータスUIが「実行状態」と連動せず、単なる装飾チップとして残っていた。

## 実施した改善
1. `run_stream` をフェーズ連動化し、`agent/phase/step/total_steps/query_type/skill` を送出。
2. タイトル制約をサーバー (`17 + …`) で強制し、フロントでもグラフェム安全にトリム。
3. ステータス行を `知識/データ/安全` に整理し、右側に実行中メッセージを表示。

## 再発防止ルール
1. 進捗UIに表示する値は「実装上の定数」ではなく「バックエンド実フェーズ」を唯一のソースにする。
2. 表示制約（文字数・フォーマット）は必ずサーバーで正規化し、フロントは補助に留める。
3. ステータスUIは「ユーザー判断に使える情報」だけ残し、実態連動しない表示は削除する。
