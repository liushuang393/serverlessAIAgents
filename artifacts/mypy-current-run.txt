========================================
型チェック中...
========================================

[Python] MyPy 型チェック中... (targets: agentflow)
agentflow/skills/versioning/diff_engine.py:319:20: error: Need type annotation
for "analysis"  [var-annotated]
            analysis = {
                       ^
agentflow/security/auth_client/config.py:38:25: error: Item "None" of
"str | None" has no attribute "rstrip"  [union-attr]
            self.base_url = (
                            ^
agentflow/storage/backend.py:231:27: error: "BaseStorageBackend" has no
attribute "get"; maybe "mget"?  [attr-defined]
                value = await self.get(key)
                              ^~~~~~~~
agentflow/storage/backend.py:243:19: error: "BaseStorageBackend" has no
attribute "set"; maybe "mset"?  [attr-defined]
                await self.set(key, value, ttl)
                      ^~~~~~~~
agentflow/skills/pdf_export.py:84:13: error: Returning Any from function
declared to return "dict[str, Any]"  [no-any-return]
                return obj.model_dump()
                ^~~~~~~~~~~~~~~~~~~~~~~
agentflow/skills/conversation_export.py:282:35: error: Argument "user_name" to
"ExportMessage" has incompatible type "Any | None"; expected "str"  [arg-type]
                            user_name=msg.get("user_name", msg.get("user_i...
                                      ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~...
agentflow/skills/conversation_export.py:284:33: error: Argument "content" to
"ExportMessage" has incompatible type "Any | None"; expected "str"  [arg-type]
                            content=msg.get("content", msg.get("text", "")...
                                    ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
agentflow/skills/versioning/version_store.py:210:13: error: Returning Any from
function declared to return "dict[str, Any]"  [no-any-return]
                return json.load(f)
                ^~~~~~~~~~~~~~~~~~~
agentflow/skills/builtin/conversation_export/conversation_export.py:282:35: error:
Argument "user_name" to "ExportMessage" has incompatible type "Any | None";
expected "str"  [arg-type]
                            user_name=msg.get("user_name", msg.get("user_i...
                                      ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~...
agentflow/skills/builtin/conversation_export/conversation_export.py:284:33: error:
Argument "content" to "ExportMessage" has incompatible type "Any | None";
expected "str"  [arg-type]
                            content=msg.get("content", msg.get("text", "")...
                                    ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
agentflow/services/semantic_layer.py:213:25: error: "str" not callable 
[operator]
        values: list[Any] = field(default_factory=list)
                            ^~~~~~~~~~~~~~~~~~~~~~~~~~~
agentflow/protocols/a2ui/emitter.py:109:19: error: Item "None" of "Any | None"
has no attribute "emit_progress"  [union-attr]
                await self._agui_emitter.emit_progress(
                      ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
agentflow/patterns/deep_agent/result_summarizer.py:228:9: error: Returning Any
from function declared to return "dict[str, Any]"  [no-any-return]
            return self._truncate_result(filtered)
            ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
agentflow/observability/logging.py:226:25: error: Incompatible types in
assignment (expression has type "TextFormatter", variable has type
"JSONFormatter")  [assignment]
                formatter = TextFormatter(include_timestamp=self._config.i...
                            ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~...
agentflow/observability/logging.py:314:19: error: Incompatible types in
assignment (expression has type "FileHandler", variable has type
"StreamHandler[TextIO | Any]")  [assignment]
            handler = logging.FileHandler(output, encoding="utf-8")
                      ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
agentflow/memory/memory_distiller.py:182:17: error: Returning Any from function
declared to return "str"  [no-any-return]
                    return response.strip()
                    ^~~~~~~~~~~~~~~~~~~~~~~
agentflow/memory/knowledge/memvid_store.py:38: error: Unused "type: ignore"
comment  [unused-ignore]
        from memvid_sdk import create as memvid_create  # type: ignore[imp...
        ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~...
agentflow/memory/knowledge/memvid_store.py:39: error: Unused "type: ignore"
comment  [unused-ignore]
        from memvid_sdk import use as memvid_use  # type: ignore[import-no...
        ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~...
agentflow/knowledge/doc_health_checker.py:453:9: error: Need type annotation
for "issues" (hint: "issues: list[<type>] = ...")  [var-annotated]
            issues = []
            ^~~~~~
agentflow/integrations/ticket_generator.py:554:35: error: Incompatible types in
assignment (expression has type "dict[str, str]", target has type
"TicketStatus")  [assignment]
                updates["metadata"] = {"last_comment": comment}
                                      ^~~~~~~~~~~~~~~~~~~~~~~~~
agentflow/deploy/serverless_generator.py:217:5: error: Value of type "object"
is not indexable  [index]
        vercel_config["functions"]["main.py"]["memory"] = config.memory_si...
        ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
agentflow/deploy/serverless_generator.py:218:5: error: Value of type "object"
is not indexable  [index]
        vercel_config["functions"]["main.py"]["maxDuration"] = config.time...
        ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
agentflow/datalake/format_handlers.py:356:9: error: Returning Any from function
declared to return "list[dict[str, Any]]"  [no-any-return]
            return table.to_pylist()
            ^~~~~~~~~~~~~~~~~~~~~~~~
agentflow/core/registry.py:56:13: error: Statement is unreachable 
[unreachable]
                msg = f"Name must be a string, got {type(name).__name__}"
                ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
agentflow/memory/vector_db/qdrant_db.py:139:23: error: Argument "topic" to
"MemoryEntry" has incompatible type "Any | None"; expected "str"  [arg-type]
                    topic=payload["topic"] if payload["topic"] else None,
                          ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
agentflow/memory/vector_db/pinecone_db.py:121:23: error: Argument "topic" to
"MemoryEntry" has incompatible type "Any | None"; expected "str"  [arg-type]
                    topic=metadata["topic"] if metadata["topic"] else None...
                          ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
agentflow/skills/base.py:111:13: error: Statement is unreachable  [unreachable]
                msg = f"data must be a dict, got {type(data).__name__}"
                ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
agentflow/skills/core/base.py:120:13: error: Statement is unreachable 
[unreachable]
                msg = f"data must be a dict, got {type(data).__name__}"
                ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
agentflow/deploy/config/manager.py:437:13: error: Returning Any from function
declared to return "dict[str, Any] | None"  [no-any-return]
                return data.get("config", {})
                ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~
agentflow/deploy/targets/modal.py:170:26: error: List item 0 has incompatible
type "None"; expected "str"  [list-item]
                    options=[None, "T4", "A10G", "A100"],
                             ^~~~
agentflow/security/reasoning_monitor.py:472:17: error: Returning Any from
function declared to return "str"  [no-any-return]
                    return response.get("content", str(response))
                    ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
agentflow/security/policy_engine.py:274:9: error: Statement is unreachable 
[unreachable]
            return AuthResult(
            ^~~~~~~~~~~~~~~~~~
agentflow/security/output_contracts.py:517:27: error: Incompatible types in
assignment (expression has type "Any | None", variable has type
"dict[str, Any]")  [assignment]
                    current = current.get(key)
                              ^~~~~~~~~~~~~~~~
agentflow/security/output_contracts.py:518:13: error: Statement is unreachable 
[unreachable]
                elif isinstance(current, list) and key.isdigit():
                ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
agentflow/security/output_contracts.py:525:17: error: Statement is unreachable 
[unreachable]
                    return None
                    ^~~~~~~~~~~
agentflow/security/hallucination_detector.py:415:9: error: Need type annotation
for "issues" (hint: "issues: list[<type>] = ...")  [var-annotated]
            issues = []
            ^~~~~~
agentflow/security/data_sanitizer.py:450:13: error: "object" has no attribute
"append"  [attr-defined]
                result["threats"].append(
                ^~~~~~~~~~~~~~~~~~~~~~~~
agentflow/security/data_sanitizer.py:466:21: error: "object" has no attribute
"append"  [attr-defined]
                        result["threats"].append(
                        ^~~~~~~~~~~~~~~~~~~~~~~~
agentflow/providers/data_provider.py:289:36: error: Argument "url" to
"SQLConfig" has incompatible type "str | None"; expected "str"  [arg-type]
                config = SQLConfig(url=db_url)
                                       ^~~~~~
agentflow/providers/data_provider.py:310:44: error: Argument "provider" to
"VectorConfig" has incompatible type "str | None"; expected "str"  [arg-type]
                config = VectorConfig(provider=vec_provider, collection=co...
                                               ^~~~~~~~~~~~
agentflow/protocols/ucp/ucp_messages.py:67:25: error: Argument
"default_factory" to "Field" has incompatible type
"Callable[[], dict[str, None]]"; expected
"Callable[[], dict[str, float | None]] | Callable[[dict[str, Any]], dict[str, float | None]]"
 [arg-type]
            default_factory=lambda: {"min": None, "max": None}, descriptio...
                            ^
agentflow/pev/result_verifier.py:117:13: error: Statement is unreachable 
[unreachable]
                verification = self._verify_threshold(result, expected)
                ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
agentflow/patterns/reflexion.py:376:22: error: Argument "severity" to
"Reflection" has incompatible type "str"; expected "Severity"  [arg-type]
                severity=template.get("severity", Severity.MEDIUM),
                         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
agentflow/core/dual_verifier.py:392:9: error: Returning Any from function
declared to return "bool"  [no-any-return]
            return val1 == val2
            ^~~~~~~~~~~~~~~~~~~
agentflow/commerce/models/intent.py:88:25: error: Argument "default_factory" to
"Field" has incompatible type "Callable[[], dict[str, None]]"; expected
"Callable[[], dict[str, float | None]] | Callable[[dict[str, Any]], dict[str, float | None]]"
 [arg-type]
            default_factory=lambda: {"min": None, "max": None},
                            ^
agentflow/api/response.py:122:16: error: Missing named argument "error" for
"APIResponse"  [call-arg]
            return cls(
                   ^~~~
agentflow/api/response.py:147:16: error: Missing named argument "data" for
"APIResponse"  [call-arg]
            return cls(
                   ^~~~
agentflow/api/response.py:147:16: error: Incompatible return value type (got
"APIResponse[T]", expected "APIResponse[None]")  [return-value]
            return cls(
                   ^~~~
agentflow/patterns/deep_agent/da_compressor.py:245:13: error: Returning Any
from function declared to return "str"  [no-any-return]
                return response.strip()
                ^~~~~~~~~~~~~~~~~~~~~~~
agentflow/hitl/postgres_checkpointer.py:275:13: error: Returning Any from
function declared to return "bool"  [no-any-return]
                return result.split()[-1] != "0"
                ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
agentflow/core/schemas.py:108:41: error: Argument 1 to "SchemaValidationError"
has incompatible type "list[ErrorDetails]"; expected "list[dict[str, Any]]" 
[arg-type]
                raise SchemaValidationError(e.errors()) from e
                                            ^~~~~~~~~~
agentflow/context/tool_selector.py:455:9: error: Returning Any from function
declared to return "float"  [no-any-return]
            return max(0.0, similarity)
            ^~~~~~~~~~~~~~~~~~~~~~~~~~~
agentflow/core/engine.py:263:21: error: Returning Any from function declared to
return "dict[str, Any]"  [no-any-return]
                        return result
                        ^~~~~~~~~~~~~
agentflow/core/tool_discovery.py:110:30: error: "ToolProvider" has no attribute
"__iter__" (not iterable)  [attr-defined]
                for tool_info in tools:
                                 ^~~~~
agentflow/core/tool_binding.py:55:5: error: Function is missing a type
annotation  [no-untyped-def]
        def __iter__(self):
        ^~~~~~~~~~~~~~~~~~~
agentflow/runtime/quota_manager.py:173:9: error: Statement is unreachable 
[unreachable]
            return now + 60
            ^~~~~~~~~~~~~~~
agentflow/pev/monitored_executor.py:224:21: error: Incompatible types in
"yield" (actual type "ExecutionEvent | BaseException", expected type
"ExecutionEvent")  [misc]
                        yield event
                        ^~~~~~~~~~~
agentflow/patterns/task_decomposer.py:582:39: error: Incompatible types in
assignment (expression has type "dict[str, Any] | BaseException", variable has
type "dict[str, Any] | None")  [assignment]
                            task.result = result
                                          ^~~~~~
agentflow/patterns/task_decomposer.py:600:13: error: Returning Any from
function declared to return "dict[str, Any]"  [no-any-return]
                return await self._executor(task)
                ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
agentflow/orchestration/monitor.py:218:5: error: Function is missing a return
type annotation  [no-untyped-def]
        async def watch(
        ^~~~~~~~~~~~~~~~
agentflow/observability/sentry_integration.py:124:13: error: Returning Any from
function declared to return "str | None"  [no-any-return]
                return sentry_sdk.capture_exception(error)
                ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
agentflow/observability/sentry_integration.py:166:13: error: Returning Any from
function declared to return "str | None"  [no-any-return]
                return sentry_sdk.capture_message(message, level=level)
                ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
agentflow/memory/embeddings/sentence_transformer_embeddings.py:70:13: error:
Returning Any from function declared to return "list[float]"  [no-any-return]
                return embedding_list
                ^~~~~~~~~~~~~~~~~~~~~
agentflow/integrations/sse_flow_runner.py:178:40: error:
"Coroutine[Any, Any, AsyncIterator[tuple[dict[str, Any] | None, AGUIEvent | None]]]"
has no attribute "__aiter__" (not async iterable)  [attr-defined]
                async for result, event in self._flow.run_with_events(inpu...
                                           ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~...
agentflow/integrations/sse_flow_runner.py:178:40: note: Maybe you forgot to use "await"?
agentflow/integrations/sse_flow_runner.py:281:25: error: Argument "flow" to
"SSEFlowRunner" has incompatible type "_SimpleFlowWrapper"; expected
"FlowProtocol | None"  [arg-type]
            return cls(flow=wrapper, flow_id=flow_id)
                            ^~~~~~~
agentflow/integrations/sse_flow_runner.py:281:25: note: Following member(s) of "_SimpleFlowWrapper" have conflicts:
agentflow/integrations/sse_flow_runner.py:281:25: note:     Expected:
agentflow/integrations/sse_flow_runner.py:281:25: note:         def run_with_events(self, input_data: dict[str, Any]) -> Coroutine[Any, Any, AsyncIterator[tuple[dict[str, Any] | None, AGUIEvent | None]]]
agentflow/integrations/sse_flow_runner.py:281:25: note:     Got:
agentflow/integrations/sse_flow_runner.py:281:25: note:         def run_with_events(self, input_data: dict[str, Any]) -> AsyncIterator[tuple[dict[str, Any] | None, AGUIEvent | None]]
agentflow/evolution/validator_worker.py:84:19: error: Item "None" of
"Any | None" has no attribute "xadd"  [union-attr]
                await self._redis.xadd(VALIDATE_STREAM_KEY, {"payload": js...
                      ^~~~~~~~~~~~~~~~
agentflow/evolution/validator_worker.py:103:30: error: Item "None" of
"Any | None" has no attribute "xreadgroup"  [union-attr]
                response = await self._redis.xreadgroup(
                                 ^~~~~~~~~~~~~~~~~~~~~~
agentflow/sandbox/builtin_tools.py:56:20: error: Incompatible types in
assignment (expression has type "DockerProvider", variable has type
"MicrosandboxProvider")  [assignment]
            instance = DockerProvider(config)
                       ^~~~~~~~~~~~~~~~~~~~~~
agentflow/sandbox/builtin_tools.py:60:20: error: Incompatible types in
assignment (expression has type "E2BProvider", variable has type
"MicrosandboxProvider")  [assignment]
            instance = E2BProvider(config)
                       ^~~~~~~~~~~~~~~~~~~
agentflow/sandbox/builtin_tools.py:145:24: error: Value of type
"Collection[str]" is not indexable  [index]
            "description": EXECUTE_CODE_TOOL_DEFINITION["function"]["descr...
                           ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~...
agentflow/orchestration/orchestrator.py:732:13: error: Returning Any from
function declared to return "StrategyDecision"  [no-any-return]
                return await self._strategy_router.route(task=task, plan=p...
                ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~...
agentflow/sandbox/workspace.py:416:13: error: Cannot determine type of
"_initialized"  [has-type]
                cls._instance._initialized = False
                ^~~~~~~~~~~~~~~~~~~~~~~~~~
agentflow/sandbox/workspace.py:421:12: error: Cannot determine type of
"_initialized"  [has-type]
            if self._initialized:
               ^~~~~~~~~~~~~~~~~
agentflow/memory/episodic_memory.py:374:9: error: Returning Any from function
declared to return "float"  [no-any-return]
            return dot_product / (norm1 * norm2)
            ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
agentflow/skills/builtin/intelligence/report_builder.py:125:17: error:
Returning Any from function declared to return "str"  [no-any-return]
                    return response.get("content", "")
                    ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
agentflow/skills/builtin/ecommerce/listing_generator.py:233:17: error:
Returning Any from function declared to return "str"  [no-any-return]
                    return response.get("content", "")[: self._config.max_...
                    ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~...
agentflow/skills/builtin/ecommerce/listing_generator.py:291:17: error:
Returning Any from function declared to return "str"  [no-any-return]
                    return response.get("content", "")
                    ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
agentflow/sdk/api/router.py:135:13: error: Returning Any from function declared
to return "AgentEngineProtocol"  [no-any-return]
                return engine()
                ^~~~~~~~~~~~~~~
agentflow/sdk/api/router.py:136:16: error: Redundant cast to
"AgentEngineProtocol"  [redundant-cast]
            return cast(AgentEngineProtocol, engine)
                   ^
agentflow/wizard/test_synthesizer.py:288:26: error: Item "LLMProvider" of
"Any | LLMProvider" has no attribute "generate"  [union-attr]
            response = await self._llm.generate(prompt)
                             ^~~~~~~~~~~~~~~~~~
Found 80 errors in 59 files (checked 603 source files)
ERROR conda.cli.main_run:execute(142): `conda run mypy agentflow --ignore-missing-imports` failed. (See above for error)
[エラー] MyPy 型チェックに失敗しました
[分類][MyPy] エラーコード上位:
     22 no-any-return
     13 arg-type
      8 unreachable
      7 assignment
      6 attr-defined
      5 union-attr
      3 var-annotated
      3 index
      2 unused-ignore
      2 no-untyped-def
[分類][MyPy] ファイル上位:
    3 agentflow/security/output_contracts.py
    3 agentflow/sandbox/builtin_tools.py
    3 agentflow/api/response.py
    2 agentflow/storage/backend.py
    2 agentflow/skills/conversation_export.py
    2 agentflow/security/data_sanitizer.py
    2 agentflow/sdk/api/router.py
    2 agentflow/sandbox/workspace.py
    2 agentflow/providers/data_provider.py
    2 agentflow/patterns/task_decomposer.py
[分析][MyPy] 自動修復可否:
  - 半自動で対応可能: import-untyped（types-* stub 追加）
  - 自動修復困難: call-arg / arg-type / assignment / union-attr / override / no-any-return
    -> これらは型定義・実装整合性の修正が必要
