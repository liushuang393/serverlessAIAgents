# AgentFlow プロジェクトルール体系生成用 AI プロンプト

> **対象**: AI アシスタント向けプロンプトテンプレート
> **目的**: 任意のプロジェクトに対して包括的なルール体系を生成
> **使用方法**: `@README.md` または `@index_ja.md` でプロジェクト情報を読み込み、本プロンプトを実行

---

## 🎯 プロンプト実行フロー

### ステップ1: プロジェクト分析
```
プロジェクトの README.md または index_ja.md を分析し、以下の情報を抽出：
- プロジェクト名と概要
- 技術スタック（言語、フレームワーク、アーキテクチャ）
- 開発方式とパターン
- 既存の開発規範やルール
- プロジェクト規模とチーム構造
- 会社固有のコーディング傾向や注意事項
```

### ステップ2: ルール体系設計
```
抽出した情報に基づき、以下の階層化されたルール体系を設計：

code-rules/
├── CLAUDE.md                    # インデックス & ナビゲーション
├── global/                      # 一般的なルール & ベストプラクティス
│   ├── principles.md           # 開発原則
│   ├── naming-guidelines.md    # 命名規則
│   ├── style-formatting.md     # スタイル & フォーマット
│   ├── error-handling.md       # エラー処理
│   └── ai-weakness.md          # AI弱点補強ルール
├── languages/                   # 言語別ルール
│   ├── python-rules.md
│   ├── java-rules.md
│   └── nodejs-rules.md
├── project/                     # プロジェクト固有
│   ├── architecture.md         # アーキテクチャ設計
│   ├── repo-structure.md       # リポジトリ構造
│   └── ci-cd-guidelines.md     # CI/CDガイドライン
├── company-specific/           # 会社固有指針
│   ├── [company]-python.md
│   ├── [company]-java.md
│   └── [company]-nodejs.md
└── tools/                       # 使用ツール
    ├── lint-format.md          # リンター & フォーマッター
    └── testing.md              # テスト方針
```

### ステップ3: ルール生成
```
各層に対して詳細なルール文書を生成：
- 実用的価値のある具体例
- 自動化可能なチェック項目
- プロジェクト特性に適したカスタマイズ
- AI弱点補強ルール（AI生成コードの品質向上）
- CLI抽出コマンド提示語（自動化メンテナンス）
```

---

## 📚 包括的なルール体系生成プロンプト

### メイン指示

あなたはプロジェクトの README.md または index_ja.md を分析し、そのプロジェクトに最適化された包括的なルール体系を生成する専門家です。生成するルール体系は以下の構造に従ってください：

#### 1. ルール体系インデックス（CLAUDE.md - 簡潔版）
```markdown
# 📌 Clause Code Rules インデックス

## 🧠 全体方針（Global）
- [開発原則](global/principles.md)
- [命名規則](global/naming-guidelines.md)
- [スタイル & フォーマット](global/style-formatting.md)
- [例外/エラー処理](global/error-handling.md)
- [AI弱点補強](global/ai-weakness.md)

## 🧠 言語別ルール
- [Pythonルール](languages/python-rules.md)
- [Javaルール](languages/java-rules.md)
- [Node.jsルール](languages/nodejs-rules.md)

## 🧠 プロジェクト固有
- [アーキテクチャ設計](project/architecture.md)
- [リポジトリ構造](project/repo-structure.md)
- [CI/CDガイドライン](project/ci-cd-guidelines.md)

## 🧠 会社固有指針
- [[会社名] Python](company-specific/[会社名]-python.md)
- [[会社名] Java](company-specific/[会社名]-java.md)
- [[会社名] Node.js](company-specific/[会社名]-nodejs.md)

## 🧠 使用ツール
- [リンター & フォーマッター](tools/lint-format.md)
- [テスト方針](tools/testing.md)
```

#### 2. フォルダ構造（階層化アーキテクチャ）
```plaintext
code-rules/
├── CLAUDE.md                    # インデックス & ナビゲーション
├── global/                      # 一般的なルール & ベストプラクティス
│   ├── principles.md           # 開発原則
│   ├── naming-guidelines.md    # 命名規則
│   ├── style-formatting.md     # スタイル & フォーマット
│   ├── error-handling.md       # エラー処理
│   └── ai-weakness.md          # AI弱点補強ルール
├── languages/                   # 言語別ルール
│   ├── python-rules.md
│   ├── java-rules.md
│   └── nodejs-rules.md
├── project/                     # プロジェクト固有
│   ├── architecture.md         # アーキテクチャ設計
│   ├── repo-structure.md       # リポジトリ構造
│   └── ci-cd-guidelines.md     # CI/CDガイドライン
├── company-specific/           # 会社固有指針
│   ├── [会社名]-python.md
│   ├── [会社名]-java.md
│   └── [会社名]-nodejs.md
└── tools/                       # 使用ツール
    ├── lint-format.md          # リンター & フォーマッター
    └── testing.md              # テスト方針
```

#### 3. AI弱点補強ルール（ai-weakness.md）
```markdown
# 🤖 AI弱点補強ルール

## ■ 脆弱性
AI生成コードは**曖昧な意図のまま書かれる**傾向あり。
→ 生成前に**仕様明文化テンプレート**を必ず作成。

## ■ 自動テスト要求
AI生成部分は **必ずユニット/統合テストを 100% カバレッジ**で補強。

## ■ コードレビュー補助
以下をBotに追加:
- 命名意図検証
- 成果物仕様と実装一致チェック
- エラー処理の完全性確認
```

#### 4. CLI抽出コマンド（自動化メンテナンス）
```bash
# 📌 Pythonコードからルール抽出
ai-extract --source ./src --filter "def|class" --target rules/languages/python-rules.md

# 📌 Javaコードからルール抽出
ai-extract --source ./src --lang java --target rules/languages/java-rules.md

# 📌 Node.jsコードからルール抽出
ai-extract --source ./src --lang js --target rules/languages/nodejs-rules.md

# 📌 ZIP自動生成
mkdir clause-code-rules && cp -r code-rules/* clause-code-rules/ && zip -r clause-code-rules.zip clause-code-rules
```

#### 2. 個別ルール文書テンプレート

各ルールカテゴリに対して以下のテンプレートを使用：

**コーディング規約テンプレート**:
```markdown
# コーディング規約

> **バージョン**: 1.0.0
> **適用範囲**: [プロジェクト名] 全 [言語] コード
> **最終更新**: [日付]

## 📋 目次

1. [[言語] バージョン要件](#言語-バージョン要件)
2. [コードフォーマッティング](#コードフォーマッティング)
3. [インポート管理](#インポート管理)
4. [型アノテーション](#型アノテーション)
5. [コード品質ツール](#コード品質ツール)
6. [自動化チェック](#自動化チェック)

---

## 🐍 [言語] バージョン要件

### サポートバージョン
```python
# 最小バージョン: [言語] [バージョン]+
# 理由: [プロジェクト固有の理由]
requires-[言語] = ">=[バージョン]"
```

### バージョン互換性
- **[バージョン]+**: 完全サポート（推奨）
- **[バージョン]**: 限定的サポート（レガシー環境のみ）
- **[バージョン] 以下**: 非サポート

---

## 🎨 コードフォーマッティング

### [フォーマッタ] 設定
[フォーマッタ] を統一的な linter および formatter として使用：

```toml
[tool.[フォーマッタ]]
[設定項目に基づいた設定]
```

### フォーマットルール

#### 基本フォーマット
```python
# ✅ 正しい: [文字数]以内で適切な改行
def process_data(
    user_id: str,
    data: dict[str, Any],
    *,
    validate: bool = True,
) -> dict[str, Any]:
    """データ処理を実行する。"""

# ❌ 間違い: 行が長すぎる
def process_data(user_id: str, data: dict[str, Any], validate: bool = True) -> dict[str, Any]:
```

[残りのテンプレートはプロジェクト固有にカスタマイズ]
```

---

## 🎯 プロジェクト固有のカスタマイズポイント

### 技術スタック別カスタマイズ

#### Python プロジェクトの場合:
- **型アノテーション**: 100% カバレッジ必須
- **非同期処理**: async/await パターン優先
- **依存性注入**: コンストラクタインジェクション
- **テスト**: pytest + カバレッジ測定
- **AI弱点補強**: AI生成コードの仕様明文化テンプレート

#### JavaScript/TypeScript プロジェクトの場合:
- **型安全**: TypeScript 必須
- **ESLint + Prettier**: コード品質とフォーマット
- **Jest**: テストフレームワーク
- **Husky**: Git フック管理
- **AI弱点補強**: AI生成コードの型安全検証

#### Java プロジェクトの場合:
- **Spring Boot**: アーキテクチャパターン
- **Maven/Gradle**: ビルド管理
- **JUnit**: テストフレームワーク
- **SpotBugs**: 静的解析
- **AI弱点補強**: AI生成コードの例外処理完全性確認

### プロジェクト規模別調整

#### 小規模プロジェクト (< 5人チーム):
- **簡易プロセス**: レビュアー1名、自動チェック中心
- **柔軟なルール**: 厳格なフォーマットより一貫性を重視
- **迅速なリリース**: 週次リリース、簡易デプロイ
- **フォルダ構造**: global/ + languages/ のみ

#### 中規模プロジェクト (5-20人チーム):
- **標準プロセス**: レビュアー2名、包括的な自動チェック
- **バランスルール**: 品質と速度のバランス
- **段階的リリース**: 機能ブランチ、ステージング環境
- **フォルダ構造**: 全フォルダ + project/ 重点

#### 大規模プロジェクト (20人以上チーム):
- **厳格プロセス**: 複数レビュアー、包括的な品質ゲート
- **厳格ルール**: 100% カバレッジ、包括的セキュリティチェック
- **複雑リリース**: ブルーグリーンデプロイ、段階的ロールアウト
- **フォルダ構造**: 全フォルダ + company-specific/ 必須

### ドメイン別考慮事項

#### AI/ML プロジェクト:
- **モデル管理**: バージョン管理と再現性
- **データ品質**: 検証と前処理標準
- **パフォーマンス**: 推論速度とメモリ使用量
- **AI弱点補強**: モデル出力の検証とテスト

#### ウェブアプリケーション:
- **セキュリティ**: OWASP トップ10対策
- **パフォーマンス**: Core Web Vitals最適化
- **アクセシビリティ**: WCAG 2.1準拠
- **AI弱点補強**: ユーザー入力検証の強化

#### マイクロサービス:
- **API設計**: REST/OpenAPI 標準
- **サービス間通信**: 非同期メッセージング
- **分散トレーシング**: オブザーバビリティ
- **AI弱点補強**: 分散システムのエラー伝播処理

### 会社固有ルール生成

#### コードパターン分析:
```bash
# 既存コードからパターンを抽出
ai-extract --source ./src --lang python --patterns "db.session|with context" --target company-specific/[会社名]-python.md
```

#### コーディング傾向分析:
- **DB接続**: コンテキストマネージャー使用パターン
- **例外処理**: ラップして再スローする傾向
- **ログ**: 構造化ログ使用パターン
- **設定**: 環境変数使用パターン

---

## 🚀 生成ワークフロー

### ステップバイステップガイド

1. **プロジェクト分析**:
   ```bash
   # README.md を読み込み、プロジェクト特性を分析
   - 技術スタック: [言語、フレームワーク、インフラ]
   - チーム規模: [小規模/中規模/大規模]
   - 開発方式: [アジャイル/ウォーターフォール/その他]
   - 既存ルール: [CONTRIBUTING.md、開発規範の有無]
   - 会社固有パターン: 既存コードのコーディング傾向分析
   ```

2. **階層化フォルダ構造設計**:
   ```bash
   # Clause Code Rules パターンでフォルダ構造を設計
   code-rules/
   ├── CLAUDE.md              # 簡潔なインデックス
   ├── global/                # 普遍的なルール
   ├── languages/             # 言語別ルール
   ├── project/               # プロジェクト固有
   ├── company-specific/      # 会社固有指針
   └── tools/                 # 自動化ツール設定
   ```

3. **ルール文書生成**:
   ```bash
   # 各フォルダに対して詳細な文書を生成
   - CLAUDE.md: ナビゲーション用インデックス
   - global/principles.md: 開発原則
   - languages/python-rules.md: Python固有ルール
   - company-specific/[会社名]-python.md: 会社固有Pythonルール
   - tools/lint-format.md: 自動化ツール設定
   ```

4. **AI弱点補強ルール生成**:
   ```bash
   # AI生成コードの品質向上ルールを追加
   - global/ai-weakness.md: AI特有の弱点補強
   - 仕様明文化テンプレート
   - 自動テスト要求ルール
   - コードレビューポイント
   ```

5. **CLI自動化スクリプト生成**:
   ```bash
   # メンテナンス自動化スクリプト
   - ai-extract コマンド: コードからルール抽出
   - ZIP自動生成スクリプト
   - 品質チェック自動化
   ```

6. **品質チェック実施**:
   ```bash
   # 生成されたルールの品質検証
   - フォルダ構造の一貫性チェック
   - クロスリファレンス検証
   - AI弱点補強ルールの有効性確認
   - 自動化スクリプトの動作確認
   ```

---

## 📋 チェックリスト: ルール体系生成完了確認

### 必須項目
- [ ] プロジェクト特性の正確な分析
- [ ] 技術スタックに適したルール設計
- [ ] チーム規模に合ったプロセス設計
- [ ] 業界ベストプラクティスの反映
- [ ] 自動化可能なチェック項目の設定

### 品質項目
- [ ] 実用的価値のある具体例の記載
- [ ] 明確な優先度設定（高/中/低）
- [ ] 段階的導入プラン
- [ ] 継続的改善メカニズム
- [ ] 包括的なドキュメント

### 自動化項目
- [ ] 品質チェックスクリプトの生成
- [ ] CI/CDワークフローの設定
- [ ] Pre-commitフックの設定
- [ ] メトリクス収集の設定

---

## 🎯 使用方法

### 基本的な使用:
```
@README.md または @index_ja.md を添付し、本プロンプトを実行してください。
AIがプロジェクトを分析し、最適化されたルール体系を生成します。
```

### 高度なカスタマイズ:
```
特定の技術スタックやチーム規模を指定する場合:
- Python + AI/ML プロジェクト
- 大規模チーム（20人以上）
- マイクロサービスアーキテクチャ
- 金融/医療ドメイン
```

### AI弱点補強機能:
```
AI生成コード品質向上のための専用ルール:
- 仕様明文化テンプレート強制
- 100%テストカバレッジ要求
- 命名意図検証
- エラー処理完全性確認
```

### 自動メンテナンス機能:
```
継続的なルール更新のためのCLIツール:
- ai-extract: 既存コードからルール抽出
- ZIP自動生成: 配布パッケージ作成
- クロスリファレンス検証
```

このプロンプトテンプレートを使用することで、任意のプロジェクトに対して包括的で実用的、かつ自動化可能なルール体系を生成できます。生成されたルールはプロジェクトの成長と共に継続的に改善され、AI生成コードの品質向上にも特化しています。

---

## 🎯 あなたのルール体系との統合メリット

### 構造的優位性:
- **階層化フォルダ**: global/、languages/、company-specific/ の明確分離
- **AI特化ルール**: ai-weakness.md でAI生成コードの品質保証
- **自動抽出機能**: CLIコマンドで既存コードからルール生成
- **ZIP配布**: 自動生成スクリプトで配布パッケージ作成

### 実用的優位性:
- **保守性向上**: フォルダ構造によるルールの分類管理
- **拡張性確保**: 会社固有ルールの独立管理
- **自動化推進**: メンテナンス作業の自動化
- **品質保証**: AI弱点補強による生成コード品質向上

---

**AI プロンプトテンプレート v2.0.0 | 統合日: 2025-01-19**
