# AgentFlowæ¡†æ¶ v2.0 - å¼€æ”¾æ ‡å‡†é›†æˆç‰ˆ

> åŸºäºPocketFlow + ä¸‰å¤§å¼€æ”¾åè®®(MCP/A2A/AG-UI)çš„ä¼ä¸šçº§AI Agentå¿«é€Ÿå¼€å‘æ¡†æ¶  
> å£å·: **æ­ç§¯æœ¨å¼å¼€å‘,æç¤ºè¯é©±åŠ¨,å¼€æ”¾æ ‡å‡†äº’è”**

---

## ğŸ¯ æ ¸å¿ƒè®¾è®¡ç†å¿µ

### ä¸‰å±‚åè®®æ ˆæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         AG-UI Layer (å‰ç«¯äº¤äº’å±‚)           â”‚  ç”¨æˆ· â†” Agent
â”‚  â€¢ å®æ—¶æµå¼UIæ›´æ–°                          â”‚
â”‚  â€¢ å¤šæ¨¡æ€äº¤äº’(æ–‡æœ¬/è¯­éŸ³/è¡¨å•)               â”‚
â”‚  â€¢ å¯è§†åŒ–AgentçŠ¶æ€                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       A2A Layer (Agentåä½œå±‚)             â”‚  Agent â†” Agent
â”‚  â€¢ è·¨æ¡†æ¶Agenté€šä¿¡                        â”‚
â”‚  â€¢ ä»»åŠ¡å§”æ‰˜ä¸åè°ƒ                          â”‚
â”‚  â€¢ åˆ†å¸ƒå¼å¤šAgentç¼–æ’                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      PocketFlow Core (æ‰§è¡Œå¼•æ“)           â”‚  
â”‚  â€¢ Node-Flowå·¥ä½œæµå¼•æ“                     â”‚
â”‚  â€¢ Shared Storeæ•°æ®ç®¡ç†                   â”‚
â”‚  â€¢ é‡è¯•/å›é€€/å¹¶å‘æ§åˆ¶                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        MCP Layer (å·¥å…·è¿æ¥å±‚)             â”‚  Agent â†” Tools/Data
â”‚  â€¢ æ ‡å‡†åŒ–å·¥å…·è°ƒç”¨                          â”‚
â”‚  â€¢ æ•°æ®æºè¿æ¥                             â”‚
â”‚  â€¢ ä¸Šä¸‹æ–‡ç®¡ç†                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç§¯æœ¨åŒ–è®¾è®¡å››åŸåˆ™

#### 1ï¸âƒ£ **æ ‡å‡†æ¥å£,æ¾è€¦åˆ**
æ¯ä¸ªAgentéƒ½æ˜¯ç‹¬ç«‹çš„"ç§¯æœ¨å—",é€šè¿‡æ ‡å‡†åè®®äº’è”:
```python
class AgentBlock:
    # A2Aæ¥å£ - Agenté—´é€šä¿¡
    def get_agent_card(self) -> AgentCard: ...
    
    # AG-UIæ¥å£ - ç”¨æˆ·äº¤äº’
    def emit_ui_event(self, event: UIEvent): ...
    
    # MCPæ¥å£ - å·¥å…·ä½¿ç”¨
    def list_tools(self) -> List[Tool]: ...
    
    # PocketFlowæ¥å£ - å·¥ä½œæµæ‰§è¡Œ
    def get_flow(self) -> Flow: ...
```

#### 2ï¸âƒ£ **çƒ­æ’æ‹”,å¯ç»„åˆ**
åƒä¹é«˜ç§¯æœ¨ä¸€æ ·è‡ªç”±ç»„åˆ:
```yaml
# äº§å“é…ç½® = Agentç§¯æœ¨ç»„åˆ
product:
  name: "æ–‡æ¡£å¤„ç†åŠ©æ‰‹"
  agents:
    - id: pdf_analyzer
      source: "local://agents/pdf_analyzer"  # æœ¬åœ°Agent
    - id: translator
      source: "a2a://translation-service.com"  # è¿œç¨‹A2A Agent
    - id: email_sender
      source: "marketplace://email-pro"  # å¸‚åœºAgent
  
  workflow:
    - when: user_upload_pdf
      call: pdf_analyzer
    - then: translator
      if: needs_translation
    - finally: email_sender
```

#### 3ï¸âƒ£ **æ¨¡æ¿åŒ–,å¯å¤åˆ¶**
å‚ç…§PocketFlowçš„æ¨¡æ¿æ€æƒ³:
```
templates/
â”œâ”€â”€ basic/              # åŸºç¡€å•Agentæ¨¡æ¿
â”œâ”€â”€ rag/                # RAGæ¨¡å¼æ¨¡æ¿  
â”œâ”€â”€ mapreduce/          # MapReduceæ¨¡å¼æ¨¡æ¿
â”œâ”€â”€ agent-orchestrator/ # å¤šAgentç¼–æ’æ¨¡æ¿
â””â”€â”€ custom/            # è‡ªå®šä¹‰æ¨¡æ¿
    â””â”€â”€ pdf-to-report/  # å…·ä½“åœºæ™¯æ¨¡æ¿(å¯å¤ç”¨)
        â”œâ”€â”€ design.md
        â”œâ”€â”€ agent.yaml
        â”œâ”€â”€ nodes.py
        â””â”€â”€ prompts/
```

#### 4ï¸âƒ£ **å¯è§†åŒ–,é›¶ä»£ç **
ä¸ºæœªæ¥çš„å¯è§†åŒ–å¹³å°é¢„ç•™æ¥å£:
```json
// agent.visual.json - å¯è§†åŒ–å…ƒæ•°æ®
{
  "ui": {
    "icon": "ğŸ“„",
    "color": "#3B82F6",
    "category": "æ–‡æ¡£å¤„ç†",
    "inputs": [
      {"name": "pdf_path", "type": "file", "accept": ".pdf"}
    ],
    "outputs": [
      {"name": "summary", "type": "text", "preview": true}
    ]
  },
  "a2a_card": {...},
  "ag_ui_events": [...]
}
```

---

## 1ï¸âƒ£ ç”¨æˆ·æ•…äº‹ (User Stories)

### US-001: ä¸€é”®å¯åŠ¨,ä¸‰åè®®æ”¯æŒ
**ä½œä¸º** å¼€å‘è€…  
**æˆ‘æƒ³è¦** åˆ›å»ºçš„Agentè‡ªåŠ¨æ”¯æŒMCP/A2A/AG-UIä¸‰ä¸ªåè®®  
**ä»¥ä¾¿** æ— ç¼æ¥å…¥æ•´ä¸ªAIç”Ÿæ€ç³»ç»Ÿ

**éªŒæ”¶æ ‡å‡†**:
```bash
agentflow init my-agent --protocols mcp,a2a,ag-ui
# ç”Ÿæˆçš„Agentè‡ªåŠ¨åŒ…å«:
# - MCPå·¥å…·å®šä¹‰(tools.mcp.json)
# - A2A AgentCard(agent.a2a.json)  
# - AG-UIäº‹ä»¶æ˜ å°„(agent.agui.json)
```

### US-002: ç§¯æœ¨å¸‚åœº,å³æœå³ç”¨
**ä½œä¸º** å¼€å‘è€…  
**æˆ‘æƒ³è¦** æœç´¢å¹¶å¯¼å…¥ç°æˆçš„Agentç§¯æœ¨  
**ä»¥ä¾¿** å¿«é€Ÿç»„è£…äº§å“åŸå‹

**éªŒæ”¶æ ‡å‡†**:
```bash
# æœç´¢Agentç§¯æœ¨
agentflow search "PDFè§£æ"
> æ‰¾åˆ°3ä¸ªç§¯æœ¨:
> 1. pdf-parser-basic (æœ¬åœ°) - åŸºç¡€PDFæ–‡æœ¬æå–
> 2. pdf-analyzer-pro (A2A) - é«˜çº§PDFåˆ†æ,æ”¯æŒè¡¨æ ¼
> 3. pdf-ocr-agent (A2A) - OCRè¯†åˆ«æ‰‹å†™PDF

# å®‰è£…å¹¶è‡ªåŠ¨é…ç½®
agentflow install pdf-analyzer-pro
> âœ… ä¸‹è½½A2A AgentCard
> âœ… é…ç½®è®¤è¯ä¿¡æ¯
> âœ… ç”Ÿæˆæœ¬åœ°é€‚é…å™¨
> âœ… æ·»åŠ åˆ°é¡¹ç›®ä¾èµ–

# åœ¨ä»£ç ä¸­ç›´æ¥ä½¿ç”¨
from agentflow import get_agent
pdf_agent = get_agent("pdf-analyzer-pro")
result = pdf_agent.run({"pdf_path": "test.pdf"})
```

### US-003: å¯è§†åŒ–ç¼–æ’,é›¶ä»£ç æ­å»º
**ä½œä¸º** äº§å“ç»ç†  
**æˆ‘æƒ³è¦** é€šè¿‡æ‹–æ‹½ç•Œé¢è®¾è®¡Agentå·¥ä½œæµ  
**ä»¥ä¾¿** ä¸éœ€è¦å†™ä»£ç å°±èƒ½åˆ›å»ºAIäº§å“

**éªŒæ”¶æ ‡å‡†**:
- âœ… æ‰“å¼€Webç¼–æ’å™¨: `agentflow studio`
- âœ… æ‹–æ‹½Agentç§¯æœ¨åˆ°ç”»å¸ƒ
- âœ… è¿æ¥Agentä¹‹é—´çš„æ•°æ®æµ
- âœ… é¢„è§ˆAG-UIäº¤äº’ç•Œé¢
- âœ… ä¸€é”®ç”Ÿæˆå¯éƒ¨ç½²ä»£ç 

### US-004: æ¨¡æ¿å¤ç”¨,æ”¹æç¤ºè¯å³å¯
**ä½œä¸º** å¼€å‘è€…  
**æˆ‘æƒ³è¦** ä½¿ç”¨æˆç†Ÿçš„åœºæ™¯æ¨¡æ¿  
**ä»¥ä¾¿** åªéœ€ä¿®æ”¹æç¤ºè¯å’Œé…ç½®å°±èƒ½ä¸Šçº¿

**éªŒæ”¶æ ‡å‡†**:
```bash
# ä»æ¨¡æ¿åˆ›å»º
agentflow create from-template invoice-processor
> ğŸ“‹ ä½¿ç”¨æ¨¡æ¿: å‘ç¥¨å¤„ç†ç³»ç»Ÿ
> ğŸ“ è¯·å›ç­”ä»¥ä¸‹é—®é¢˜æ¥å®šåˆ¶ä½ çš„Agent:
> 
> 1. å‘ç¥¨æ ¼å¼? [PDF/å›¾ç‰‡/Excel] PDF
> 2. éœ€è¦æå–å“ªäº›å­—æ®µ? å‘ç¥¨å·,é‡‘é¢,æ—¥æœŸ,ä¾›åº”å•†
> 3. å¤„ç†ååŠ¨ä½œ? [ä¿å­˜æ•°æ®åº“/å‘é€é‚®ä»¶/ç”ŸæˆæŠ¥è¡¨] ä¿å­˜æ•°æ®åº“
>
> âœ… ç”Ÿæˆå®Œæˆ!åªéœ€ä¿®æ”¹ prompts/extract.txt ä¸­çš„æå–è§„åˆ™
```

---

## 2ï¸âƒ£ æ¡†æ¶éœ€æ±‚ (Framework Requirements)

### æ ¸å¿ƒæ¶æ„å›¾

```mermaid
graph TB
    subgraph "ç”¨æˆ·ç•Œé¢å±‚"
        WebUI[Webç•Œé¢<br/>AG-UIåè®®]
        MobileUI[ç§»åŠ¨ç«¯<br/>AG-UIåè®®]
        VSCODE[VS Codeæ’ä»¶<br/>AG-UIåè®®]
    end
    
    subgraph "AgentFlowæ ¸å¿ƒ"
        Studio[å¯è§†åŒ–ç¼–æ’å™¨]
        Registry[Agentç§¯æœ¨å¸‚åœº]
        CLI[å‘½ä»¤è¡Œå·¥å…·]
        
        subgraph "è¿è¡Œæ—¶å¼•æ“"
            A2AServer[A2A Server<br/>Agentåä½œ]
            AGUIEmitter[AG-UI Emitter<br/>UIäº‹ä»¶æµ]
            FlowEngine[PocketFlow Engine<br/>å·¥ä½œæµæ‰§è¡Œ]
            MCPClient[MCP Client<br/>å·¥å…·è°ƒç”¨]
        end
    end
    
    subgraph "Agentç§¯æœ¨åº“"
        LocalAgent[æœ¬åœ°Agentç§¯æœ¨]
        RemoteAgent[è¿œç¨‹A2A Agent]
        MarketAgent[å¸‚åœºAgentç§¯æœ¨]
    end
    
    subgraph "å·¥å…·ä¸æ•°æ®å±‚"
        MCPTools[MCPå·¥å…·æœåŠ¡å™¨]
        Database[(æ•°æ®åº“)]
        APIs[å¤–éƒ¨API]
    end
    
    WebUI --> AGUIEmitter
    MobileUI --> AGUIEmitter
    VSCODE --> AGUIEmitter
    
    Studio --> Registry
    CLI --> Registry
    Registry --> LocalAgent
    Registry --> RemoteAgent
    Registry --> MarketAgent
    
    AGUIEmitter --> FlowEngine
    A2AServer --> FlowEngine
    FlowEngine --> MCPClient
    
    RemoteAgent -.A2Aåè®®.-> A2AServer
    FlowEngine --> LocalAgent
    MCPClient --> MCPTools
    MCPClient --> Database
    MCPClient --> APIs
```

### æŠ€æœ¯æ ˆé€‰å‹

| å±‚çº§ | æŠ€æœ¯é€‰æ‹© | ç†ç”± |
|------|---------|------|
| **å·¥ä½œæµå¼•æ“** | PocketFlow (100è¡Œ) | ç®€å•ã€æ˜“æ‰©å±•ã€AIå‹å¥½ |
| **A2Aé€šä¿¡** | google-a2a SDK | å®˜æ–¹SDK,ç”Ÿæ€æ”¯æŒå¥½ |
| **AG-UIå®ç°** | AG-UI Python SDK | æ”¯æŒSSEæµå¼è¾“å‡º |
| **MCPå®¢æˆ·ç«¯** | mcp Python SDK | Anthropicå®˜æ–¹ |
| **å¯è§†åŒ–** | React Flow + shadcn/ui | æ‹–æ‹½å¼ç¼–æ’ |
| **CLI** | Click + Rich | ç¾è§‚çš„å‘½ä»¤è¡Œ |
| **é…ç½®ç®¡ç†** | YAML + Pydantic | ç±»å‹å®‰å…¨ |

### é¡¹ç›®ç»“æ„ v2.0

```
agentflow-project/
â”œâ”€â”€ .agentflow/                 # æ¡†æ¶é…ç½®ç›®å½•
â”‚   â”œâ”€â”€ config.yaml             # é¡¹ç›®å…¨å±€é…ç½®
â”‚   â”œâ”€â”€ protocols/              # åè®®é…ç½®
â”‚   â”‚   â”œâ”€â”€ mcp.json            # MCPå·¥å…·æ¸…å•
â”‚   â”‚   â”œâ”€â”€ a2a.json            # A2A AgentCard
â”‚   â”‚   â””â”€â”€ agui.json           # AG-UIäº‹ä»¶å®šä¹‰
â”‚   â”œâ”€â”€ prompts/                # AIåŠ©æ‰‹æç¤ºè¯åº“
â”‚   â”‚   â”œâ”€â”€ design.prompt
â”‚   â”‚   â”œâ”€â”€ implement.prompt
â”‚   â”‚   â””â”€â”€ optimize.prompt
â”‚   â””â”€â”€ registry.yaml           # å·²å®‰è£…Agentæ¸…å•
â”‚
â”œâ”€â”€ agents/                     # Agentç§¯æœ¨åº“
â”‚   â””â”€â”€ my_agent/               # å•ä¸ªAgentç§¯æœ¨
â”‚       â”œâ”€â”€ agent.yaml  Yeah.         # Agentå…ƒæ•°æ®(ç§¯æœ¨è¯´æ˜ä¹¦)
â”‚       â”œâ”€â”€ design.md           # è®¾è®¡æ–‡æ¡£
â”‚       â”œâ”€â”€ nodes.py            # PocketFlow Nodes
â”‚       â”œâ”€â”€ flow.py             # PocketFlow Flow
â”‚       â”œâ”€â”€ a2a_adapter.py      # A2Aé€‚é…å™¨
â”‚       â”œâ”€â”€ agui_events.py      # AG-UIäº‹ä»¶å®šä¹‰
â”‚       â””â”€â”€ visual.json         # å¯è§†åŒ–å…ƒæ•°æ®
â”‚
â”œâ”€â”€ tools/                      # MCPå·¥å…·åº“
â”‚   â”œâ”€â”€ mcp_server.py           # MCPæœåŠ¡å™¨
â”‚   â”œâ”€â”€ llm_tools.py
â”‚   â”œâ”€â”€ file_tools.py
â”‚   â””â”€â”€ custom_tools.py
â”‚
â”œâ”€â”€ workflows/                  # äº§å“çº§å·¥ä½œæµ(ç§¯æœ¨ç»„åˆ)
â”‚   â””â”€â”€ document_processor/
â”‚       â”œâ”€â”€ workflow.yaml       # å·¥ä½œæµå®šä¹‰
â”‚       â”œâ”€â”€ orchestrator.py     # ç¼–æ’é€»è¾‘
â”‚       â””â”€â”€ ui_config.yaml      # AG-UIç•Œé¢é…ç½®
â”‚
â”œâ”€â”€ tests/                      # æµ‹è¯•
â”‚   â”œâ”€â”€ test_agents.py
â”‚   â”œâ”€â”€ test_tools.py
â”‚   â””â”€â”€ test_protocols.py       # åè®®å…¼å®¹æ€§æµ‹è¯•
â”‚
â”œâ”€â”€ main.py                     # ä¸»å…¥å£
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md
```

### Agentç§¯æœ¨è§„èŒƒ (agent.yaml)

```yaml
# agents/pdf_analyzer/agent.yaml
meta:
  id: pdf-analyzer-v1
  name: "PDFåˆ†æå™¨"
  version: "1.0.0"
  author: "your-team"
  icon: "ğŸ“„"
  category: "æ–‡æ¡£å¤„ç†"
  description: "é«˜çº§PDFåˆ†æ,æ”¯æŒæ–‡æœ¬æå–ã€è¡¨æ ¼è¯†åˆ«ã€æ‘˜è¦ç”Ÿæˆ"
  
# ç§¯æœ¨æ¥å£å®šä¹‰
interfaces:
  # è¾“å…¥æ¥å£(æ’åº§)
  inputs:
    - name: pdf_path
      type: file
      required: true
      accept: [".pdf"]
      description: "å¾…åˆ†æçš„PDFæ–‡ä»¶è·¯å¾„"
    - name: analysis_type
      type: enum
      options: ["extract", "summarize", "qa"]
      default: "extract"
      
  # è¾“å‡ºæ¥å£(æ’å¤´)
  outputs:
    - name: result
      type: object
      schema:
        text: string
        tables: array
        metadata: object
        
# åè®®æ”¯æŒ
protocols:
  mcp:
    tools: ["read_pdf", "extract_tables"]
    resources: ["pdf_content"]
    
  a2a:
    enabled: true
    card_path: "./a2a_card.json"
    skills: ["document_analysis", "table_extraction"]
    
  agui:
    enabled: true
    events:
      - type: "TEXT_MESSAGE_CONTENT"  # æµå¼è¾“å‡ºåˆ†æè¿›åº¦
      - type: "TOOL_CALL_START"       # æ˜¾ç¤ºå·¥å…·è°ƒç”¨
      - type: "STATE_DELTA"           # æ›´æ–°åˆ†æçŠ¶æ€
      
# ä¾èµ–å…³ç³»
dependencies:
  agents: []  # ä¸ä¾èµ–å…¶ä»–Agent
  tools:      # MCPå·¥å…·ä¾èµ–
    - mcp://file-tools/read_pdf
    - mcp://llm-tools/summarize
  packages:   # PythonåŒ…ä¾èµ–
    - PyPDF2>=3.0.0
    - pdfplumber>=0.9.0
    
# PocketFlowé…ç½®
pocketflow:
  entry: "flow.py:create_pdf_analysis_flow"
  shared_schema: "schemas.py:PDFAnalysisSchema"
  
# å¯è§†åŒ–é…ç½®
visual:
  color: "#3B82F6"
  size: "medium"  # small/medium/large
  ports:
    input: ["left"]
    output: ["right"]
```

---

## 3ï¸âƒ£ è¯¦ç»†æœºèƒ½è®¾è®¡

### æœºèƒ½1: ä¸‰åè®®è‡ªåŠ¨é€‚é…å™¨

**è®¾è®¡ç›®æ ‡**: Agentå¼€å‘è€…åªéœ€å…³æ³¨ä¸šåŠ¡é€»è¾‘,åè®®å±‚è‡ªåŠ¨ç”Ÿæˆ

```python
# agentflow/adapters.py
from agentflow import AgentBlock, auto_adapt

@auto_adapt(protocols=["mcp", "a2a", "agui"])
class PDFAnalyzerAgent(AgentBlock):
    """åªéœ€å®ç°æ ¸å¿ƒä¸šåŠ¡é€»è¾‘,åè®®é€‚é…è‡ªåŠ¨å®Œæˆ"""
    
    def __init__(self):
        self.metadata = self.load_metadata("agent.yaml")
        self.flow = self.create_flow()
    
    # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ - PocketFlow
    def create_flow(self) -> Flow:
        read_node = ReadPDFNode()
        analyze_node = AnalyzeNode()
        output_node = OutputNode()
        
        read_node >> analyze_node >> output_node
        return Flow(start=read_node)
    
    # ä»¥ä¸‹æ–¹æ³•ç”±@auto_adaptè£…é¥°å™¨è‡ªåŠ¨ç”Ÿæˆ:
    
    # def get_mcp_tools(self) -> List[Tool]:
    #     """è‡ªåŠ¨ä»agent.yamlçš„protocols.mcpç”Ÿæˆ"""
    #     ...
    
    # def get_a2a_card(self) -> AgentCard:
    #     """è‡ªåŠ¨ä»agent.yamlçš„protocols.a2aç”Ÿæˆ"""
    #     ...
    
    # def emit_agui_events(self, flow_state):
    #     """è‡ªåŠ¨å°†Flowæ‰§è¡ŒçŠ¶æ€è½¬ä¸ºAG-UIäº‹ä»¶"""
    #     ...
```

**è‡ªåŠ¨é€‚é…å™¨å®ç°é€»è¾‘**:

```python
# agentflow/adapters/auto_adapter.py
class ProtocolAdapter:
    @staticmethod
    def generate_mcp_tools(agent_meta: dict) -> List[Tool]:
        """ä»agent.yamlè‡ªåŠ¨ç”ŸæˆMCPå·¥å…·å®šä¹‰"""
        tools = []
        for tool_uri in agent_meta["protocols"]["mcp"]["tools"]:
            # è§£æ mcp://category/tool_name
            category, name = parse_mcp_uri(tool_uri)
            tool_def = load_tool_definition(category, name)
            tools.append(tool_def)
        return tools
    
    @staticmethod
    def generate_a2a_card(agent_meta: dict) -> AgentCard:
        """ç”ŸæˆA2A AgentCard"""
        return AgentCard(
            name=agent_meta["meta"]["name"],
            description=agent_meta["meta"]["description"],
            version=agent_meta["meta"]["version"],
            skills=[
                Skill(
                    name=skill,
                    input_schema=agent_meta["interfaces"]["inputs"],
                    output_schema=agent_meta["interfaces"]["outputs"]
                )
                for skill in agent_meta["protocols"]["a2a"]["skills"]
            ],
            endpoint=f"http://localhost:8000/agents/{agent_meta['meta']['id']}"
        )
    
    @staticmethod
    def wrap_flow_with_agui(flow: Flow, agent_meta: dict):
        """å°†PocketFlowçš„æ‰§è¡ŒåŒ…è£…ä¸ºAG-UIäº‹ä»¶æµ"""
        
        # åœ¨Flowæ‰§è¡Œå‰
        def on_flow_start(shared):
            emit_agui_event({
                "type": "RUN_STARTED",
                "data": {"agent": agent_meta["meta"]["name"]}
            })
        
        # Nodeæ‰§è¡Œæ—¶
        def on_node_exec(node, input_data):
            emit_agui_event({
                "type": "TOOL_CALL_START",
                "data": {"tool": node.__class__.__name__, "input": input_data}
            })
        
        # æµå¼è¾“å‡ºæ—¶
        def on_llm_stream(token):
            emit_agui_event({
                "type": "TEXT_MESSAGE_CONTENT",
                "data": {"delta": token}
            })
        
        # çŠ¶æ€å˜åŒ–æ—¶
        def on_state_change(old_state, new_state):
            emit_agui_event({
                "type": "STATE_DELTA",
                "data": {"patch": diff(old_state, new_state)}
            })
        
        # æ³¨å…¥é’©å­åˆ°Flow
        flow.register_hooks({
            "on_start": on_flow_start,
            "on_node_exec": on_node_exec,
            "on_llm_token": on_llm_stream,
            "on_state_change": on_state_change
        })
```

### æœºèƒ½2: Agentç§¯æœ¨å¸‚åœº

**æœ¬åœ°å¸‚åœº** (`.agentflow/marketplace/`)
```
marketplace/
â”œâ”€â”€ index.yaml              # å¸‚åœºç´¢å¼•
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ pdf-analyzer/
â”‚   â”‚   â”œâ”€â”€ agent.yaml
â”‚   â”‚   â”œâ”€â”€ package.tar.gz
â”‚   â”‚   â””â”€â”€ README.md
â”‚   â””â”€â”€ email-sender/
â””â”€â”€ templates/
    â””â”€â”€ invoice-processor/  # æ•´å¥—æ¨¡æ¿
```

**è¿œç¨‹å¸‚åœºAPI**:
```python
# agentflow/marketplace.py
class AgentMarketplace:
    def search(self, query: str, filters: dict = None):
        """æœç´¢Agentç§¯æœ¨"""
        # æ”¯æŒæ ‡ç­¾ã€åˆ†ç±»ã€åè®®æ”¯æŒç­‰è¿‡æ»¤
        return [
            {
                "id": "pdf-analyzer-pro",
                "name": "PDFé«˜çº§åˆ†æå™¨",
                "author": "acme-corp",
                "version": "2.1.0",
                "protocols": ["mcp", "a2a", "agui"],
                "rating": 4.8,
                "downloads": 15234,
                "price": "free",  # or "premium"
                "source": "a2a://marketplace.agentflow.ai/pdf-analyzer-pro"
            }
        ]
    
    def install(self, agent_id: str):
        """å®‰è£…Agentç§¯æœ¨"""
        # 1. ä¸‹è½½AgentåŒ…æˆ–è·å–A2A endpoint
        # 2. è§£æä¾èµ–å…³ç³»
        # 3. å®‰è£…ä¾èµ–çš„å·¥å…·å’Œå…¶ä»–Agent
        # 4. ç”Ÿæˆæœ¬åœ°é€‚é…å™¨ä»£ç 
        # 5. æ›´æ–°registry.yaml
        pass
    
    def publish(self, agent_path: str):
        """å‘å¸ƒè‡ªå·±çš„Agentåˆ°å¸‚åœº"""
        # 1. éªŒè¯agent.yamlå®Œæ•´æ€§
        # 2. è¿è¡Œåè®®å…¼å®¹æ€§æµ‹è¯•
        # 3. æ‰“åŒ…å¹¶ä¸Šä¼ 
        # 4. ç”ŸæˆA2A endpoint(å¦‚æœæ˜¯è¿œç¨‹Agent)
        pass
```

### æœºèƒ½3: å¯è§†åŒ–ç¼–æ’å™¨ (AgentFlow Studio)

**å¯åŠ¨æ–¹å¼**:
```bash
agentflow studio
> ğŸ¨ AgentFlow Studio å·²å¯åŠ¨
> ğŸŒ è®¿é—®: http://localhost:3000
```

**æ ¸å¿ƒåŠŸèƒ½**:

1. **ç”»å¸ƒç¼–æ’**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [File] [Edit] [View] [Agents]  [ğŸ”Search Agents]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚   ğŸ“¤ User Upload                                   â”‚
â”‚        â”‚                                           â”‚
â”‚        â†“                                           â”‚
â”‚   [ğŸ“„ PDF Analyzer]  â†â”€ ä»å¸‚åœºæ‹–æ‹½çš„Agentç§¯æœ¨         â”‚
â”‚        â”‚                                           â”‚
â”‚        â”œâ”€â†’ {text}                                  â”‚
â”‚        â”œâ”€â†’ {tables}                                â”‚
â”‚        â”‚                                           â”‚
â”‚        â†“                                           â”‚
â”‚   [ğŸŒ Translator]                                  â”‚
â”‚        â”‚                                           â”‚
â”‚        â†“                                           â”‚
â”‚   [ğŸ“§ Email Sender]                                â”‚
â”‚        â”‚                                           â”‚
â”‚        â†“                                           â”‚
â”‚   âœ… Done                                          â”‚
â”‚                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Properties:          Preview:                     â”‚
â”‚  Agent: PDF Analyzer  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  ID: pdf-analyzer     â”‚  [Test Run] ğŸ”„  â”‚         â”‚
â”‚  Inputs:              â”‚                 â”‚         â”‚
â”‚    â€¢ pdf_path: file   â”‚  ğŸ“„ åˆ†æä¸­...   â”‚         â”‚
â”‚  Outputs:             â”‚  â–“â–“â–“â–“â–‘â–‘â–‘â–‘ 50%   â”‚         â”‚
â”‚    â€¢ text: string     â”‚                 â”‚         â”‚
â”‚    â€¢ tables: array    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

2. **å®æ—¶é¢„è§ˆ**
   - ç‚¹å‡»"Test Run"å¯ä»¥æµ‹è¯•æ•´ä¸ªå·¥ä½œæµ
   - é€šè¿‡AG-UIåè®®å®æ—¶æ˜¾ç¤ºAgentçŠ¶æ€
   - æ”¯æŒæ–­ç‚¹è°ƒè¯•

3. **ä¸€é”®ç”Ÿæˆä»£ç **
```python
# studioè‡ªåŠ¨ç”Ÿæˆçš„workflowä»£ç 
# workflows/my_workflow/orchestrator.py

from agentflow import get_agent, Workflow

class MyWorkflow(Workflow):
    def __init__(self):
        # åŠ è½½ç”»å¸ƒä¸Šçš„Agentç§¯æœ¨
        self.pdf_analyzer = get_agent("pdf-analyzer")
        self.translator = get_agent("translator")
        self.email_sender = get_agent("email-sender")
    
    async def run(self, user_input):
        # æŒ‰ç”»å¸ƒè¿æ¥é¡ºåºæ‰§è¡Œ
        pdf_result = await self.pdf_analyzer.run({
            "pdf_path": user_input["file"]
        })
        
        translated = await self.translator.run({
            "text": pdf_result["text"],
            "target_lang": "en"
        })
        
        await self.email_sender.run({
            "to": user_input["email"],
            "content": translated["text"]
        })
        
        return {"status": "success"}
```

### æœºèƒ½4: æ¨¡æ¿ç³»ç»Ÿå¢å¼º

**åœºæ™¯æ¨¡æ¿åº“**:
```
templates/
â”œâ”€â”€ scenarios/                  # å…·ä½“ä¸šåŠ¡åœºæ™¯æ¨¡æ¿
â”‚   â”œâ”€â”€ invoice-processor/      # å‘ç¥¨å¤„ç†
â”‚   â”‚   â”œâ”€â”€ README.md
â”‚   â”‚   â”œâ”€â”€ template.yaml       # æ¨¡æ¿å…ƒæ•°æ®
â”‚   â”‚   â”œâ”€â”€ agents/             # é¢„é…ç½®çš„Agent
â”‚   â”‚   â”œâ”€â”€ prompts/            # å¯å®šåˆ¶çš„æç¤ºè¯
â”‚   â”‚   â””â”€â”€ config.example.yaml # é…ç½®ç¤ºä¾‹
â”‚   â”‚
â”‚   â”œâ”€â”€ customer-service-bot/   # å®¢æœæœºå™¨äºº
â”‚   â”œâ”€â”€ data-analysis-pipeline/ # æ•°æ®åˆ†æç®¡é“
â”‚   â””â”€â”€ email-automation/       # é‚®ä»¶è‡ªåŠ¨åŒ–
â”‚
â””â”€â”€ patterns/                   # è®¾è®¡æ¨¡å¼æ¨¡æ¿
    â”œâ”€â”€ rag/
    â”œâ”€â”€ mapreduce/
    â””â”€â”€ multi-agent-debate/
```

**æ¨¡æ¿å…ƒæ•°æ®** (template.yaml):
```yaml
meta:
  id: invoice-processor-v1
  name: "å‘ç¥¨å¤„ç†ç³»ç»Ÿ"
  description: "è‡ªåŠ¨å¤„ç†PDF/å›¾ç‰‡å‘ç¥¨,æå–ä¿¡æ¯å¹¶ä¿å­˜åˆ°æ•°æ®åº“"
  author: "agentflow-team"
  version: "1.0.0"
  difficulty: "beginner"  # beginner/intermediate/advanced
  
# æ¨¡æ¿åŒ…å«çš„ç§¯æœ¨
includes:
  agents:
    - pdf-extractor
    - invoice-parser
    - database-writer
  tools:
    - pdf-reader
    - ocr-tool
    - db-connector
    
# å¯å®šåˆ¶å‚æ•°(å‘å¯¼å¼é…ç½®)
customization:
  questions:
    - id: invoice_format
      prompt: "å‘ç¥¨æ ¼å¼?"
      type: select
      options: ["PDF", "å›¾ç‰‡", "Excel"]
      default: "PDF"
      
    - id: extract_fields
      prompt: "éœ€è¦æå–å“ªäº›å­—æ®µ?"
      type: multiselect
      options: ["å‘ç¥¨å·", "é‡‘é¢", "æ—¥æœŸ", "ä¾›åº”å•†", "ç¨é¢"]
      default: ["å‘ç¥¨å·", "é‡‘é¢", "æ—¥æœŸ"]
      
    - id: output_action
      prompt: "å¤„ç†ååŠ¨ä½œ?"
      type: select
      options: ["ä¿å­˜æ•°æ®åº“", "å‘é€é‚®ä»¶", "ç”ŸæˆæŠ¥è¡¨"]
      default: "ä¿å­˜æ•°æ®åº“"
      
  # åŸºäºç”¨æˆ·å›ç­”ç”Ÿæˆé…ç½®
  config_template: |
    invoice:
      format: {{ invoice_format }}
      fields: {{ extract_fields | join(', ') }}
    output:
      action: {{ output_action }}
      
# éœ€è¦ä¿®æ”¹çš„æç¤ºè¯æ–‡ä»¶
prompts_to_edit:
  - path: "prompts/extract.txt"
    description: "ä¿®æ”¹å‘ç¥¨å­—æ®µæå–è§„åˆ™"
    example: |
      ä»å‘ç¥¨ä¸­æå–ä»¥ä¸‹ä¿¡æ¯:
      - å‘ç¥¨å·ç : é€šå¸¸åœ¨å³ä¸Šè§’
      - é‡‘é¢: æŸ¥æ‰¾"åˆè®¡"æˆ–"æ€»è®¡"
      ...
      
# éƒ¨ç½²é…ç½®
deployment:
  type: "standalone"  # standalone/cloud/edge
  dependencies:
    - PostgreSQL >= 12
  environment:
    - DATABASE_URL
    - OCR_API_KEY
```

**ä½¿ç”¨æ¨¡æ¿çš„å‘½ä»¤**:
```bash
# äº¤äº’å¼åˆ›å»º
agentflow create from-template invoice-processor

# è¾“å‡º:
ğŸ“‹ ä½¿ç”¨æ¨¡æ¿: å‘ç¥¨å¤„ç†ç³»ç»Ÿ v1.0.0
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ è¯·å›ç­”ä»¥ä¸‹é—®é¢˜æ¥å®šåˆ¶ä½ çš„Agent:

â“ å‘ç¥¨æ ¼å¼? 
   1) PDF  2) å›¾ç‰‡  3) Excel
ğŸ‘‰ é€‰æ‹© [1]: 1

â“ éœ€è¦æå–å“ªäº›å­—æ®µ? (å¤šé€‰,ç©ºæ ¼åˆ†éš”)
   1) å‘ç¥¨å·  2) é‡‘é¢  3) æ—¥æœŸ  4) ä¾›åº”å•†  5) ç¨é¢
ğŸ‘‰ é€‰æ‹© [1 2 3]: 1 2 3 4

â“ å¤„ç†ååŠ¨ä½œ?
   1) ä¿å­˜æ•°æ®åº“  2) å‘é€é‚®ä»¶  3) ç”ŸæˆæŠ¥è¡¨
ğŸ‘‰ é€‰æ‹© [1]: 1

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… é¡¹ç›®åˆ›å»ºå®Œæˆ!

ğŸ“ é¡¹ç›®ç»“æ„:
   invoice-processor/
   â”œâ”€â”€ agents/
   â”‚   â”œâ”€â”€ pdf-extractor/
   â”‚   â”œâ”€â”€ invoice-parser/
   â”‚   â””â”€â”€ database-writer/
   â”œâ”€â”€ prompts/
   â”‚   â””â”€â”€ extract.txt  âš ï¸  éœ€è¦å¾®è°ƒ
   â””â”€â”€ config.yaml

ğŸ¯ ä¸‹ä¸€æ­¥:
   1. cd invoice-processor
   2. ç¼–è¾‘ prompts/extract.txt è°ƒæ•´æå–è§„åˆ™
   3. é…ç½® .env æ–‡ä»¶(DATABASE_URLç­‰)
   4. agentflow run --test  # æµ‹è¯•è¿è¡Œ
   5. agentflow deploy      # éƒ¨ç½²ä¸Šçº¿

ğŸ’¡ AIåŠ©æ‰‹å·²å‡†å¤‡å¥½ååŠ©ä½ !åœ¨Cursorä¸­æ‰“å¼€é¡¹ç›®,
   AIä¼šè‡ªåŠ¨ç†è§£è¿™ä¸ªæ¨¡æ¿å¹¶å¸®ä½ å¿«é€Ÿå®šåˆ¶ã€‚
```

---

## 4ï¸âƒ£ å®ç°ä»»åŠ¡æ¸…å•

### é˜¶æ®µ1: æ ¸å¿ƒæ¡†æ¶ + åè®®é›†æˆ (Week 1-3)

#### Task 1.1: PocketFlowæ ¸å¿ƒåŒ…è£…
**ä¼˜å…ˆçº§**: P0  
**å·¥æ—¶**: 2å¤©

```python
# agentflow/core/flow_engine.py
from pocketflow import Node, Flow as PocketFlow

class AgentFlowEngine:
    """PocketFlowåŒ…è£…å™¨,å¢åŠ åè®®é’©å­"""
    
    def __init__(self, flow: PocketFlow):
        self.flow = flow
        self.hooks = {
            "on_start": [],
            "on_node_exec": [],
            "on_node_complete": [],
            "on_state_change": [],
            "on_finish": []
        }
    
    def register_hook(self, event: str, callback):
        """æ³¨å†Œäº‹ä»¶é’©å­"""
        self.hooks[event].append(callback)
    
    def run(self, shared: dict):
        """æ‰§è¡ŒFlowå¹¶è§¦å‘é’©å­"""
        # è§¦å‘å¼€å§‹é’©å­
        for hook in self.hooks["on_start"]:
            hook(shared)
        
        # æ‰§è¡ŒPocketFlow (éœ€è¦monkey patch Node)
        result = self.flow.run(shared)
        
        # è§¦å‘å®Œæˆé’©å­
        for hook in self.hooks["on_finish"]:
            hook(shared, result)
        
        return result
```

#### Task 1.2: MCPå®¢æˆ·ç«¯é›†æˆ
**ä¼˜å…ˆçº§**: P0  
**å·¥æ—¶**: 3å¤©

```python
# agentflow/protocols/mcp_client.py
from mcp import ClientSession, StdioServerParameters
from mcp.client.stdio import stdio_client

class MCPToolManager:
    """MCPå·¥å…·ç®¡ç†å™¨"""
    
    def __init__(self, mcp_config_path: str):
        self.config = load_yaml(mcp_config_path)
        self.sessions = {}  # æ¯ä¸ªMCPæœåŠ¡å™¨ä¸€ä¸ªsession
    
    async def connect_all_servers(self):
        """è¿æ¥æ‰€æœ‰MCPæœåŠ¡å™¨"""
        for server in self.config["servers"]:
            session = await self._connect_server(server)
            self.sessions[server["name"]] = session
    
    async def _connect_server(self, server_config):
        """è¿æ¥å•ä¸ªMCPæœåŠ¡å™¨"""
        server_params = StdioServerParameters(
            command=server_config["command"],
            args=server_config.get("args", []),
            env=server_config.get("env", {})
        )
        
        async with stdio_client(server_params) as (read, write):
            async with ClientSession(read, write) as session:
                await session.initialize()
                
                # åˆ—å‡ºå¯ç”¨å·¥å…·
                tools = await session.list_tools()
                print(f"âœ… è¿æ¥MCPæœåŠ¡å™¨: {server_config['name']}")
                print(f"   å¯ç”¨å·¥å…·: {[t.name for t in tools]}")
                
                return session
    
    async def call_tool(self, tool_uri: str, arguments: dict):
        """è°ƒç”¨MCPå·¥å…·
        
        Args:
            tool_uri: æ ¼å¼ mcp://server_name/tool_name
            arguments: å·¥å…·å‚æ•°
        """
        server_name, tool_name = self._parse_uri(tool_uri)
        session = self.sessions[server_name]
        
        result = await session.call_tool(tool_name, arguments)
        return result
    
    def generate_tool_definitions(self):
        """ç”Ÿæˆå·¥å…·å®šä¹‰ä¾›LLMä½¿ç”¨"""
        tools = []
        for server_name, session in self.sessions.items():
            for tool in session.list_tools():
                tools.append({
                    "name": f"{server_name}/{tool.name}",
                    "description": tool.description,
                    "parameters": tool.inputSchema
                })
        return tools
```

**MCPé…ç½®ç¤ºä¾‹** (.agentflow/protocols/mcp.yaml):
```yaml
servers:
  - name: file-tools
    command: npx
    args: ["-y", "@modelcontextprotocol/server-filesystem", "/path/to/data"]
    
  - name: database-tools
    command: npx
    args: ["-y", "@modelcontextprotocol/server-postgres"]
    env:
      DATABASE_URL: "postgresql://user:pass@localhost/db"
      
  - name: custom-tools
    command: python
    args: ["tools/mcp_server.py"]
```

#### Task 1.3: A2A Server/Clientå®ç°
**ä¼˜å…ˆçº§**: P0  
**å·¥æ—¶**: 4å¤©

```python
# agentflow/protocols/a2a_server.py
from google_a2a import A2AServer, AgentCard, Skill

class AgentFlowA2AServer:
    """A2AæœåŠ¡å™¨,æš´éœ²æœ¬åœ°Agentç»™è¿œç¨‹è°ƒç”¨"""
    
    def __init__(self, port: int = 8000):
        self.port = port
        self.agents = {}  # æ³¨å†Œçš„Agent
        self.server = A2AServer()
    
    def register_agent(self, agent_block):
        """æ³¨å†ŒAgentåˆ°A2AæœåŠ¡å™¨"""
        # ä»agent.yamlç”ŸæˆAgentCard
        card = self._generate_card(agent_block)
        
        # æ³¨å†Œå¤„ç†å‡½æ•°
        @self.server.task_handler(card.name)
        async def handle_task(task):
            # è°ƒç”¨Agentçš„PocketFlowæ‰§è¡Œ
            result = await agent_block.run(task.input)
            return result
        
        self.agents[card.name] = agent_block
        print(f"âœ… Agentå·²æ³¨å†Œåˆ°A2A: {card.name}")
    
    def _generate_card(self, agent_block) -> AgentCard:
        """ä»agent.yamlç”ŸæˆAgentCard"""
        meta = agent_block.metadata
        
        return AgentCard(
            name=meta["meta"]["name"],
            description=meta["meta"]["description"],
            version=meta["meta"]["version"],
            endpoint=f"http://localhost:{self.port}/agents/{meta['meta']['id']}",
            skills=[
                Skill(
                    name=skill,
                    description=f"{meta['meta']['name']} - {skill}",
                    input_schema=meta["interfaces"]["inputs"],
                    output_schema=meta["interfaces"]["outputs"]
                )
                for skill in meta["protocols"]["a2a"]["skills"]
            ]
        )
    
    def start(self):
        """å¯åŠ¨A2AæœåŠ¡å™¨"""
        print(f"ğŸš€ A2A Serverå¯åŠ¨: http://localhost:{self.port}")
        self.server.run(port=self.port)


# agentflow/protocols/a2a_client.py
class AgentFlowA2AClient:
    """A2Aå®¢æˆ·ç«¯,è°ƒç”¨è¿œç¨‹Agent"""
    
    def __init__(self):
        self.remote_agents = {}  # ç¼“å­˜è¿œç¨‹Agentçš„AgentCard
    
    async def discover_agent(self, endpoint: str):
        """å‘ç°è¿œç¨‹Agent"""
        # è·å–AgentCard
        card = await fetch_agent_card(endpoint)
        self.remote_agents[card.name] = {
            "card": card,
            "endpoint": endpoint
        }
        return card
    
    async def call_remote_agent(self, agent_name: str, input_data: dict):
        """è°ƒç”¨è¿œç¨‹Agent"""
        agent_info = self.remote_agents[agent_name]
        
        # å‘é€A2Aä»»åŠ¡
        result = await send_a2a_task(
            endpoint=agent_info["endpoint"],
            skill=agent_info["card"].skills[0].name,  # ç®€åŒ–:ä½¿ç”¨ç¬¬ä¸€ä¸ªskill
            input=input_data
        )
        
        return result
```

#### Task 1.4: AG-UIäº‹ä»¶æµå®ç°
**ä¼˜å…ˆçº§**: P1  
**å·¥æ—¶**: 3å¤©

```python
# agentflow/protocols/agui_emitter.py
from ag_ui import AGUIServer, Event

class AGUIEventEmitter:
    """AG-UIäº‹ä»¶å‘å°„å™¨"""
    
    def __init__(self):
        self.server = AGUIServer()
        self.current_run_id = None
    
    def attach_to_flow(self, flow_engine: AgentFlowEngine):
        """å°†AG-UIäº‹ä»¶ç»‘å®šåˆ°Flowæ‰§è¡Œ"""
        
        # æ³¨å†Œé’©å­
        flow_engine.register_hook("on_start", self._on_flow_start)
        flow_engine.register_hook("on_node_exec", self._on_node_exec)
        flow_engine.register_hook("on_state_change", self._on_state_change)
        flow_engine.register_hook("on_finish", self._on_flow_finish)
    
    def _on_flow_start(self, shared):
        """Flowå¼€å§‹"""
        self.current_run_id = generate_id()
        self.emit({
            "type": "RUN_STARTED",
            "run_id": self.current_run_id,
            "timestamp": now()
        })
    
    def _on_node_exec(self, node, input_data):
        """Nodeæ‰§è¡Œ"""
        self.emit({
            "type": "TOOL_CALL_START",
            "run_id": self.current_run_id,
            "data": {
                "tool_name": node.__class__.__name__,
                "arguments": input_data
            }
        })
    
    def _on_state_change(self, old_state, new_state):
        """çŠ¶æ€å˜åŒ–"""
        delta = diff_dict(old_state, new_state)
        self.emit({
            "type": "STATE_DELTA",
            "run_id": self.current_run_id,
            "data": {"patch": delta}
        })
    
    def _on_flow_finish(self, shared, result):
        """Flowå®Œæˆ"""
        self.emit({
            "type": "RUN_FINISHED",
            "run_id": self.current_run_id,
            "data": {"result": result}
        })
    
    def emit(self, event: dict):
        """å‘é€AG-UIäº‹ä»¶(SSE)"""
        self.server.send_event(Event(**event))
    
    def stream_llm_tokens(self, token_generator):
        """æµå¼è¾“å‡ºLLM token"""
        for token in token_generator:
            self.emit({
                "type": "TEXT_MESSAGE_CONTENT",
                "run_id": self.current_run_id,
                "data": {"delta": token}
            })
```

### é˜¶æ®µ2: CLIå·¥å…· + å¸‚åœº (Week 4-5)

#### Task 2.1: CLIå‘½ä»¤å®ç°
```bash
agentflow --help

Commands:
  init              åˆ›å»ºæ–°é¡¹ç›®
  create            åˆ›å»ºAgent/Tool/Workflow
  install           ä»å¸‚åœºå®‰è£…Agent
  search            æœç´¢Agentå¸‚åœº
  list              åˆ—å‡ºæœ¬åœ°èµ„æº
  run               è¿è¡ŒAgent/Workflow
  test              æµ‹è¯•Agent
  deploy            éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
  studio            å¯åŠ¨å¯è§†åŒ–ç¼–æ’å™¨
  protocols         åè®®ç®¡ç†(test/validate)
```

#### Task 2.2: Agentå¸‚åœºAPI
```python
# æœç´¢
agentflow search "PDFå¤„ç†" --filter protocols=a2a,mcp

# å®‰è£…
agentflow install pdf-analyzer-pro
> ğŸ“¦ æ­£åœ¨å®‰è£…: pdf-analyzer-pro@2.1.0
> â¬‡ï¸  ä¸‹è½½AgentCard...
> ğŸ” è§£æä¾èµ–: PyPDF2, pdfplumber
> âœ… å®‰è£…å®Œæˆ!
> 
> ä½¿ç”¨æ–¹æ³•:
>   from agentflow import get_agent
>   agent = get_agent("pdf-analyzer-pro")

# å‘å¸ƒ
agentflow publish ./agents/my-agent --price free
```

### é˜¶æ®µ3: å¯è§†åŒ–Studio (Week 6-8)

#### Task 3.1: React Flowç”»å¸ƒ
- æ‹–æ‹½Agentç§¯æœ¨
- è¿æ¥æ•°æ®æµ
- å±æ€§ç¼–è¾‘å™¨
- å®æ—¶é¢„è§ˆ

#### Task 3.2: AG-UIå‰ç«¯é›†æˆ
```typescript
// studioå‰ç«¯é€šè¿‡AG-UIåè®®è¿æ¥åç«¯
import { useAGUI } from '@ag-ui/react'

function AgentPreview({ agentId }) {
  const { events, sendMessage } = useAGUI(`http://localhost:8000/agents/${agentId}`)
  
  return (
    <div>
      {events.map(event => {
        switch(event.type) {
          case 'TEXT_MESSAGE_CONTENT':
            return <StreamingText delta={event.data.delta} />
          case 'TOOL_CALL_START':
            return <ToolIndicator tool={event.data.tool_name} />
          case 'STATE_DELTA':
            return <StateViewer patch={event.data.patch} />
        }
      })}
    </div>
  )
}
```

### é˜¶æ®µ4: æ¨¡æ¿å’Œæ–‡æ¡£ (Week 9-10)

#### Task 4.1: åˆ›å»º10ä¸ªåœºæ™¯æ¨¡æ¿
1. å‘ç¥¨å¤„ç†ç³»ç»Ÿ âœ“
2. å®¢æœèŠå¤©æœºå™¨äºº
3. æ•°æ®åˆ†æç®¡é“
4. é‚®ä»¶è‡ªåŠ¨åŒ–
5. æ–‡æ¡£ç¿»è¯‘æœåŠ¡
6. ä»£ç å®¡æŸ¥åŠ©æ‰‹
7. ä¼šè®®çºªè¦ç”Ÿæˆ
8. ç¤¾äº¤åª’ä½“å†…å®¹åˆ›ä½œ
9. ç®€å†ç­›é€‰ç³»ç»Ÿ
10. æ™ºèƒ½é—®ç­”ç³»ç»Ÿ

#### Task 4.2: å®Œæ•´æ–‡æ¡£
- å¿«é€Ÿå¼€å§‹æŒ‡å—
- åè®®é›†æˆæ•™ç¨‹
- Agentå¼€å‘æŒ‡å—
- ç§¯æœ¨å¸‚åœºä½¿ç”¨
- å¯è§†åŒ–ç¼–æ’æ•™ç¨‹
- æœ€ä½³å®è·µ
- APIå‚è€ƒ

---

## 5ï¸âƒ£ Cursor/Windsurf AIåŠ©æ‰‹æç¤ºè¯

### æç¤ºè¯æ¨¡æ¿åº“

#### 1. é¡¹ç›®åˆå§‹åŒ–æç¤ºè¯
```
æˆ‘è¦ä½¿ç”¨AgentFlowæ¡†æ¶åˆ›å»ºä¸€ä¸ªæ–°çš„AI Agenté¡¹ç›®ã€‚

é¡¹ç›®éœ€æ±‚:
- é¡¹ç›®åç§°: [é¡¹ç›®å]
- ä¸»è¦åŠŸèƒ½: [æè¿°åŠŸèƒ½]
- åè®®æ”¯æŒ: MCP, A2A, AG-UI å…¨éƒ¨å¯ç”¨
- è®¾è®¡æ¨¡å¼: [RAG/MapReduce/Agent/Workflow]

è¯·å¸®æˆ‘:
1. è¿è¡Œ agentflow init å‘½ä»¤åˆ›å»ºé¡¹ç›®ç»“æ„
2. ç”Ÿæˆ agent.yaml é…ç½®æ–‡ä»¶
3. åˆ›å»ºç¬¦åˆä¸‰åè®®æ ‡å‡†çš„é€‚é…å™¨ä»£ç 
4. ç”Ÿæˆ design.md è®¾è®¡æ–‡æ¡£

AgentFlowæ¡†æ¶è§„èŒƒ:
- é¡¹ç›®ç»“æ„å‚è€ƒ AgentFlow v2.0 æ–‡æ¡£
- agent.yamlå¿…é¡»åŒ…å« protocols é…ç½®
- è‡ªåŠ¨ç”ŸæˆMCP/A2A/AG-UIé€‚é…å™¨

è¯·é€æ­¥æ‰§è¡Œ,ç­‰å¾…æˆ‘ç¡®è®¤æ¯ä¸€æ­¥ã€‚
```

#### 2. Agentå¼€å‘æç¤ºè¯
```
åŸºäºAgentFlowæ¡†æ¶,å¼€å‘ä¸€ä¸ª[Agentåç§°]ã€‚

åŠŸèƒ½éœ€æ±‚:
{è¯¦ç»†æè¿°åŠŸèƒ½}

æŠ€æœ¯çº¦æŸ:
- å¿…é¡»æ”¯æŒMCP/A2A/AG-UIä¸‰åè®®
- ä½¿ç”¨PocketFlowä½œä¸ºå·¥ä½œæµå¼•æ“
- è¾“å…¥:[æè¿°è¾“å…¥]
- è¾“å‡º:[æè¿°è¾“å‡º]

å¼€å‘æ­¥éª¤:
1. å…ˆå®Œæˆ design.md è®¾è®¡æ–‡æ¡£
   - é€‰æ‹©åˆé€‚çš„è®¾è®¡æ¨¡å¼
   - è®¾è®¡Nodeå’ŒFlowç»“æ„
   - å®šä¹‰Shared Store Schema
   - è¯†åˆ«éœ€è¦çš„MCPå·¥å…·

2. å®ç° agent.yaml å…ƒæ•°æ®
   - å®šä¹‰inputs/outputsæ¥å£
   - é…ç½®protocolsæ”¯æŒ
   - å£°æ˜dependencies

3. å®ç°PocketFlowä»£ç 
   - nodes.py: å®ç°æ‰€æœ‰Node
   - flow.py: è¿æ¥Flow
   - schemas.py: Pydanticæ•°æ®æ¨¡å‹

4. åè®®é€‚é…
   - ä½¿ç”¨ @auto_adapt è£…é¥°å™¨
   - ç¡®ä¿MCPå·¥å…·æ­£ç¡®æ³¨å†Œ
   - ç”ŸæˆA2A AgentCard
   - é…ç½®AG-UIäº‹ä»¶æ˜ å°„

5. æµ‹è¯•
   - å•å…ƒæµ‹è¯•
   - åè®®å…¼å®¹æ€§æµ‹è¯•
   - ç«¯åˆ°ç«¯æµ‹è¯•

è¯·ä»è®¾è®¡æ–‡æ¡£å¼€å§‹,æ¯å®Œæˆä¸€æ­¥æš‚åœç­‰æˆ‘ç¡®è®¤ã€‚
```

#### 3. ç§¯æœ¨ç»„åˆæç¤ºè¯
```
æˆ‘è¦ç»„åˆå¤šä¸ªAgentç§¯æœ¨åˆ›å»ºä¸€ä¸ªäº§å“çº§å·¥ä½œæµã€‚

äº§å“åç§°: [äº§å“å]
ä¸šåŠ¡åœºæ™¯: [æè¿°åœºæ™¯]

éœ€è¦çš„Agentç§¯æœ¨:
1. [Agent1] - åŠŸèƒ½: [æè¿°]
2. [Agent2] - åŠŸèƒ½: [æè¿°]  
3. [Agent3] - åŠŸèƒ½: [æè¿°]

æ•°æ®æµ:
User Input â†’ Agent1 â†’ Agent2 â†’ Agent3 â†’ Output

è¯·å¸®æˆ‘:
1. æ£€æŸ¥è¿™äº›Agentæ˜¯å¦åœ¨å¸‚åœºå­˜åœ¨
   agentflow search [å…³é”®è¯]
   
2. å®‰è£…éœ€è¦çš„Agent
   agentflow install [agent-id]
   
3. åˆ›å»ºå·¥ä½œæµç¼–æ’ä»£ç  workflows/[product-name]/orchestrator.py
   - ä½¿ç”¨A2Aåè®®è¿æ¥è¿œç¨‹Agent
   - å¤„ç†Agenté—´æ•°æ®ä¼ é€’
   - å®ç°é”™è¯¯å¤„ç†å’Œé‡è¯•
   
4. é…ç½®AG-UIç•Œé¢ workflows/[product-name]/ui_config.yaml
   - è®¾è®¡ç”¨æˆ·è¾“å…¥è¡¨å•
   - é…ç½®å®æ—¶çŠ¶æ€æ˜¾ç¤º
   
5. ç¼–å†™æµ‹è¯•ç”¨ä¾‹

AgentFlowè§„èŒƒ:
- å·¥ä½œæµä½¿ç”¨ AgentFlow.Workflow åŸºç±»
- ä¼˜å…ˆä½¿ç”¨A2Aåè®®è°ƒç”¨è¿œç¨‹Agent
- æ•°æ®ä¼ é€’ä½¿ç”¨æ ‡å‡†åŒ–çš„Schema

å¼€å§‹å®ç°,é‡åˆ°é—®é¢˜åŠæ—¶è¯¢é—®æˆ‘ã€‚
```

#### 4. æ¨¡æ¿å®šåˆ¶æç¤ºè¯
```
ä½¿ç”¨AgentFlowæ¨¡æ¿å¿«é€Ÿåˆ›å»ºé¡¹ç›®ã€‚

æ¨¡æ¿åç§°: invoice-processor
å®šåˆ¶éœ€æ±‚:
- å‘ç¥¨æ ¼å¼: PDF
- æå–å­—æ®µ: [å­—æ®µåˆ—è¡¨]
- è¾“å‡ºæ–¹å¼: ä¿å­˜åˆ°PostgreSQL

æ­¥éª¤:
1. agentflow create from-template invoice-processor
   
2. æ ¹æ®å®šåˆ¶éœ€æ±‚ä¿®æ”¹é…ç½®:
   - config.yaml: æ›´æ–°æ•°æ®åº“è¿æ¥
   - prompts/extract.txt: è°ƒæ•´å­—æ®µæå–è§„åˆ™
   
3. ä¿®æ”¹agent.yamlé€‚åº”æˆ‘çš„éœ€æ±‚:
   - æ›´æ–°inputs/outputså®šä¹‰
   - è°ƒæ•´dependencies
   
4. æµ‹è¯•è¿è¡Œ:
   agentflow run --test
   
5. å¦‚æœ‰é—®é¢˜,ä½¿ç”¨AG-UIè°ƒè¯•ç•Œé¢æŸ¥çœ‹å®æ—¶æ—¥å¿—

è¯·å¸®æˆ‘æ‰§è¡Œè¿™äº›æ­¥éª¤,å¹¶è§£é‡Šæ¯ä¸ªé…ç½®çš„ä½œç”¨ã€‚
```

---

## 6ï¸âƒ£ æ€»ç»“ä¸è·¯çº¿å›¾

### æ ¸å¿ƒä»·å€¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         AgentFlow = ç®€å• + å¼€æ”¾ + ç§¯æœ¨åŒ–                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  ğŸ¯ PocketFlowå†…æ ¸      â†’ 100è¡Œ,AIå‹å¥½                  â”‚
â”‚  ğŸŒ ä¸‰åè®®æ”¯æŒ          â†’ MCP/A2A/AG-UIå…¨è¦†ç›–            â”‚
â”‚  ğŸ§© ç§¯æœ¨åŒ–è®¾è®¡          â†’ æ­ç§¯æœ¨å¼å¼€å‘                   â”‚
â”‚  ğŸ“¦ æ¨¡æ¿ç³»ç»Ÿ            â†’ æ”¹æç¤ºè¯å³å¯ç”¨                  â”‚
â”‚  ğŸ¨ å¯è§†åŒ–ç¼–æ’          â†’ é›¶ä»£ç æ­å»º                     â”‚
â”‚  ğŸ¤– AIåŠ©æ‰‹å‹å¥½          â†’ Cursor/WindsurfåŸç”Ÿæ”¯æŒ        â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸å…¶ä»–æ¡†æ¶å¯¹æ¯”

| ç‰¹æ€§ | AgentFlow | LangChain | CrewAI | AutoGen |
|------|-----------|-----------|--------|---------|
| **æ ¸å¿ƒä»£ç è¡Œæ•°** | ~500è¡Œ | ~50Kè¡Œ | ~10Kè¡Œ | ~20Kè¡Œ |
| **MCPæ”¯æŒ** | âœ… åŸç”Ÿ | âš ï¸ éœ€æ’ä»¶ | âŒ | âŒ |
| **A2Aæ”¯æŒ** | âœ… åŸç”Ÿ | âŒ | âš ï¸ å®éªŒæ€§ | âŒ |
| **AG-UIæ”¯æŒ** | âœ… åŸç”Ÿ | âŒ | âœ… | âŒ |
| **ç§¯æœ¨åŒ–è®¾è®¡** | âœ… | âš ï¸ å¤æ‚ | âš ï¸ éƒ¨åˆ† | âŒ |
| **å¯è§†åŒ–ç¼–æ’** | âœ… | âŒ | âŒ | âŒ |
| **æ¨¡æ¿ç³»ç»Ÿ** | âœ… | âš ï¸ ç®€å• | âš ï¸ ç®€å• | âŒ |
| **AIåŠ©æ‰‹å‹å¥½** | âœ… æä½³ | âš ï¸ ä¸€èˆ¬ | âœ… | âš ï¸ |

### å¼€å‘è·¯çº¿å›¾

**Q1 2026: MVPç‰ˆæœ¬**
- âœ… PocketFlowé›†æˆ
- âœ… MCP/A2A/AG-UIåŸºç¡€æ”¯æŒ
- âœ… CLIå·¥å…·
- âœ… 3ä¸ªåœºæ™¯æ¨¡æ¿
- âœ… åŸºç¡€æ–‡æ¡£

**Q2 2026: å¸‚åœºç‰ˆæœ¬**
- ğŸ”„ Agentç§¯æœ¨å¸‚åœº
- ğŸ”„ å¯è§†åŒ–Studio (Beta)
- ğŸ”„ 10ä¸ªåœºæ™¯æ¨¡æ¿
- ğŸ”„ ç¤¾åŒºè´¡çŒ®æœºåˆ¶

**Q3 2026: ä¼ä¸šç‰ˆæœ¬**
- ğŸ“… ä¼ä¸šçº§å®‰å…¨è®¤è¯
- ğŸ“… å¤šç§Ÿæˆ·æ”¯æŒ
- ğŸ“… æ€§èƒ½ç›‘æ§
- ğŸ“… SaaSäº‘æœåŠ¡

**Q4 2026: ç”Ÿæ€ç‰ˆæœ¬**
- ğŸ“… ç¬¬ä¸‰æ–¹é›†æˆå¸‚åœº
- ğŸ“… AIåŠ©æ‰‹æ·±åº¦é›†æˆ
- ğŸ“… ç§»åŠ¨ç«¯æ”¯æŒ
- ğŸ“… å›½é™…åŒ–

---

## é™„å½•: å¿«é€Ÿå‚è€ƒ

### å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

```bash
# é¡¹ç›®ç®¡ç†
agentflow init <name>                 # åˆ›å»ºé¡¹ç›®
agentflow create agent <name>         # åˆ›å»ºAgent
agentflow create from-template <tpl>  # ä»æ¨¡æ¿åˆ›å»º

# å¸‚åœºæ“ä½œ
agentflow search <query>              # æœç´¢Agent
agentflow install <agent-id>          # å®‰è£…Agent
agentflow publish <path>              # å‘å¸ƒAgent

# è¿è¡Œå’Œæµ‹è¯•
agentflow run <agent-name>            # è¿è¡ŒAgent
agentflow test                        # æµ‹è¯•
agentflow studio                      # å¯åŠ¨å¯è§†åŒ–

# åè®®ç®¡ç†
agentflow protocols test              # æµ‹è¯•åè®®å…¼å®¹æ€§
agentflow protocols validate          # éªŒè¯é…ç½®
```

### agent.yaml å¿«é€Ÿæ¨¡æ¿

```yaml
meta: {id, name, version, author, icon, category, description}
interfaces:
  inputs: [{name, type, required, description}]
  outputs: [{name, type, schema}]
protocols:
  mcp: {tools, resources}
  a2a: {enabled, skills}
  agui: {enabled, events}
dependencies: {agents, tools, packages}
pocketflow: {entry, shared_schema}
visual: {color, size, ports}
```

### åè®®æ–‡æ¡£é“¾æ¥

- **MCP**: https://modelcontextprotocol.io
- **A2A**: https://github.com/google-a2a/A2A
- **AG-UI**: https://docs.ag-ui.com

---

**AgentFlow: è®©AI Agentå¼€å‘åƒæ­ç§¯æœ¨ä¸€æ ·ç®€å•!** ğŸš€
