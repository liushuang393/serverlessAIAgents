# AgentFlow ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆæ›¸

> **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 2.0.0
> **æ›´æ–°æ—¥**: 2025-01-20

---

## ğŸ“‹ æ¦‚è¦

AgentFlow ã¯**ã‚·ãƒ³ãƒ—ãƒ«ã•**ã¨**æŸ”è»Ÿæ€§**ã‚’ä¸¡ç«‹ã—ãŸå¤š Agent ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚

### è¨­è¨ˆå“²å­¦

| åŸå‰‡ | èª¬æ˜ |
|------|------|
| **ç°¡æ½”** | ã‚³ã‚¢ã‚³ãƒ¼ãƒ‰ã¯ç´„500è¡Œã€å­¦ç¿’ã‚³ã‚¹ãƒˆæœ€å° |
| **æŸ”è»Ÿ** | ãƒ—ãƒ©ã‚°ã‚¤ãƒ³/å·¥å ´ãƒ‘ã‚¿ãƒ¼ãƒ³ã§è‡ªç”±ã«æ‹¡å¼µ |
| **çµ±ä¸€** | MCP/A2A/AG-UI/A2UI ã‚’çµ±ä¸€ API ã§æä¾› |
| **å‹å®‰å…¨** | Python 3.12+ å‹ãƒ’ãƒ³ãƒˆå®Œå…¨æ´»ç”¨ |

---

## ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AgentFlow Framework                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“± UI å±¤                                                        â”‚
â”‚     â”œâ”€â”€ AG-UI: ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒˆãƒªãƒ¼ãƒ ï¼ˆé€šä¿¡ãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼‰              â”‚
â”‚     â””â”€â”€ A2UI: å®£è¨€å¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆUI è¦ç¯„ï¼‰                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ¤– Agent å±¤                                                     â”‚
â”‚     â”œâ”€â”€ AgentBlock: Agent åŸºåº•ã‚¯ãƒ©ã‚¹                            â”‚
â”‚     â”œâ”€â”€ Skills: Claude Skills å½¢å¼ã®æŒ‡ç¤ºãƒ•ã‚¡ã‚¤ãƒ«                â”‚
â”‚     â””â”€â”€ Coordinator: å”èª¿ãƒ‘ã‚¿ãƒ¼ãƒ³ (Supervisor/Hierarchical)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ”— å”èª¿å±¤                                                       â”‚
â”‚     â””â”€â”€ A2A: Agent é–“é€šä¿¡ (ç™ºè¦‹ãƒ»å§”è­²ãƒ»å”èª¿)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ”§ ãƒ„ãƒ¼ãƒ«å±¤                                                     â”‚
â”‚     â””â”€â”€ MCP: å¤–éƒ¨ãƒ„ãƒ¼ãƒ«æ¥ç¶š (DB/API/ãƒ•ã‚¡ã‚¤ãƒ«)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âš™ï¸ ã‚³ã‚¢å±¤                                                       â”‚
â”‚     â”œâ”€â”€ Registry: çµ±ä¸€ç™»éŒ²/å–å¾—ãƒ‘ã‚¿ãƒ¼ãƒ³                         â”‚
â”‚     â”œâ”€â”€ Engine: PocketFlow ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚¨ãƒ³ã‚¸ãƒ³                 â”‚
â”‚     â””â”€â”€ Metadata: agent.yaml ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”‘ ã‚³ã‚¢ã‚³ãƒ³ã‚»ãƒ—ãƒˆ

### 1. çµ±ä¸€ãƒ¬ã‚¸ã‚¹ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³

ã™ã¹ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆProtocol/Skill/Coordinatorï¼‰ã‚’çµ±ä¸€ API ã§ç®¡ç†ï¼š

```python
from agentflow.core.registry import Registry

# åŸºæœ¬æ“ä½œ
registry.register("name", item)      # ç™»éŒ²
registry.get("name")                  # å–å¾—ï¼ˆNone è¨±å®¹ï¼‰
registry.get_or_raise("name")         # å–å¾—ï¼ˆä¾‹å¤–ä»˜ãï¼‰
registry.unregister("name")           # å‰Šé™¤
registry.list_names()                 # åå‰ä¸€è¦§
registry.list_all()                   # å…¨ã‚¢ã‚¤ãƒ†ãƒ 
```

**è¨­è¨ˆåŸå‰‡**ï¼š
- ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ï¼ˆ`threading.Lock`ï¼‰
- å‹å®‰å…¨ï¼ˆ`Generic[T]`ï¼‰
- é‡è¤‡ç™»éŒ²è­¦å‘Šï¼ˆä¸Šæ›¸ãå¯èƒ½ï¼‰

### 2. AgentBlock åŸºåº•ã‚¯ãƒ©ã‚¹

ã™ã¹ã¦ã® Agent ã®åŸºåº•ï¼š

```python
from agentflow.core.agent_block import AgentBlock

class MyAgent(AgentBlock):
    async def initialize(self) -> None:
        """åˆæœŸåŒ–å‡¦ç†"""
        await super().initialize()

    async def run(self, input_data: dict) -> dict:
        """ãƒ¡ã‚¤ãƒ³å‡¦ç†ï¼ˆå¿…é ˆå®Ÿè£…ï¼‰"""
        return {"result": "..."}

    async def cleanup(self) -> None:
        """çµ‚äº†å‡¦ç†"""
        await super().cleanup()

# ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ä½¿ç”¨
async with MyAgent() as agent:
    result = await agent.run({"input": "data"})
```

### 3. å”èª¿ãƒ‘ã‚¿ãƒ¼ãƒ³

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | ã‚¯ãƒ©ã‚¹ | èª¬æ˜ |
|---------|--------|------|
| Sequential | `CoordinatorBase` | é †æ¬¡å®Ÿè¡Œ |
| Concurrent | `CoordinatorBase` | ä¸¦è¡Œå®Ÿè¡Œ |
| **Supervisor** | `SupervisorCoordinator` | ç›£ç£è€…ãŒå‹•çš„ã«ãƒ¯ãƒ¼ã‚«ãƒ¼é¸æŠ |
| **Hierarchical** | `HierarchicalCoordinator` | éšå±¤çš„ã‚¿ã‚¹ã‚¯åˆ†è§£ |
| Handoff | `CoordinatorBase` | å‹•çš„å§”è­² |

**Supervisor ãƒ‘ã‚¿ãƒ¼ãƒ³ä¾‹**ï¼š
```python
from agentflow.patterns.supervisor import SupervisorCoordinator

coordinator = SupervisorCoordinator(
    supervisor=supervisor_agent,
    workers={"research": research_agent, "write": write_agent},
    max_iterations=10
)
result = await coordinator.execute("å¸‚å ´èª¿æŸ»ãƒ¬ãƒãƒ¼ãƒˆä½œæˆ")
```

### 4. Skills è‡ªå‹•é€²åŒ–ã‚·ã‚¹ãƒ†ãƒ 

Claude Code Skills å®Œå…¨äº’æ›ã®**è‡ªå‹•é€²åŒ–èƒ½åŠ›ã‚·ã‚¹ãƒ†ãƒ **ï¼š

```
ç”¨æˆ·éœ€æ±‚ â†’ æŠ€èƒ½åŒ¹é… â†’ å­˜åœ¨ãªã‚‰å®Ÿè¡Œ
                   â†’ ä¸åœ¨ãªã‚‰è‡ªå‹•ç”Ÿæˆ â†’ æ¤œè¨¼ â†’ å›ºåŒ– â†’ å®Ÿè¡Œ
= è¶Šç”¨è¶Šå‰å®³ï¼ˆä½¿ã†ã»ã©å¼·ããªã‚‹ï¼‰
```

**SKILL.md ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**:
```markdown
---
name: pdf-extractor
description: PDFã‹ã‚‰ãƒ†ã‚­ã‚¹ãƒˆã‚’æŠ½å‡ºã€‚PDFæ“ä½œæ™‚ã«ä½¿ç”¨ã€‚
triggers: [pdf, extract text]
requirements: [pypdf]
tags: [document]
---
# Instructions
å…·ä½“çš„ãªå®Ÿè¡Œæ‰‹é †...
```

**è‡ªå‹•é€²åŒ–ã‚¨ãƒ³ã‚¸ãƒ³**:
```python
from agentflow.skills import SkillEngine

engine = SkillEngine(auto_learn=True)

# ãƒãƒƒãƒ or è‡ªå‹•ç”Ÿæˆ
result = await engine.resolve("PDFã‚’è§£æã—ãŸã„")
if result.generated:
    print(f"æ–°ã‚¹ã‚­ãƒ«ç”Ÿæˆ: {result.skill.name}")
```

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | å½¹å‰² |
|--------------|------|
| `SkillMatcher` | triggers/description ã§ãƒãƒƒãƒãƒ³ã‚° |
| `SkillGenerator` | LLM ã§æ–°ã‚¹ã‚­ãƒ«è‡ªå‹•ç”Ÿæˆ |
| `SkillValidator` | ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒ»å®‰å…¨æ€§æ¤œè¨¼ |
| `SkillPersister` | learned_skills ã¸å›ºåŒ– |
| `SkillEngine` | çµ±åˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ |

è©³ç´°ã¯ [Skills ã‚¬ã‚¤ãƒ‰](guide-skills.md) ã‚’å‚ç…§ã€‚

---

## ğŸ“¦ ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚¹ã‚¿ãƒƒã‚¯

### AG-UI vs A2UI

| æ¯”è¼ƒ | AG-UI | A2UI |
|------|-------|------|
| **ç¨®åˆ¥** | é€šä¿¡ãƒ—ãƒ­ãƒˆã‚³ãƒ« | UI è¦ç¯„ |
| **å½¹å‰²** | ã‚¤ãƒ™ãƒ³ãƒˆé…ä¿¡ | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨˜è¿° |
| **é¡æ¯”** | HTTP | HTML |

### ãƒ—ãƒ­ãƒˆã‚³ãƒ«é¸æŠã‚¬ã‚¤ãƒ‰

| ã‚·ãƒŠãƒªã‚ª | æ¨å¥¨ãƒ—ãƒ­ãƒˆã‚³ãƒ« |
|---------|---------------|
| å¤–éƒ¨ãƒ„ãƒ¼ãƒ«æ¥ç¶š | MCP |
| Agent é–“å”èª¿ | A2A |
| UI æ›´æ–°é€šçŸ¥ | AG-UI |
| å‹•çš„ UI ç”Ÿæˆ | A2UI (AG-UI çµŒç”±) |

---

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
agentflow/
â”œâ”€â”€ core/                 # ã‚³ã‚¢ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”œâ”€â”€ agent_block.py    # Agent åŸºåº•ã‚¯ãƒ©ã‚¹
â”‚   â”œâ”€â”€ registry.py       # çµ±ä¸€ãƒ¬ã‚¸ã‚¹ãƒˆãƒª
â”‚   â”œâ”€â”€ engine.py         # ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚¨ãƒ³ã‚¸ãƒ³
â”‚   â””â”€â”€ metadata.py       # ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†
â”œâ”€â”€ patterns/             # å”èª¿ãƒ‘ã‚¿ãƒ¼ãƒ³
â”‚   â”œâ”€â”€ coordinator.py    # å”èª¿å™¨åŸºåº•
â”‚   â”œâ”€â”€ supervisor.py     # Supervisor ãƒ‘ã‚¿ãƒ¼ãƒ³
â”‚   â””â”€â”€ hierarchical.py   # Hierarchical ãƒ‘ã‚¿ãƒ¼ãƒ³
â”œâ”€â”€ protocols/            # ãƒ—ãƒ­ãƒˆã‚³ãƒ«å®Ÿè£…
â”‚   â”œâ”€â”€ mcp_client.py     # MCP ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ a2a_server.py     # A2A ã‚µãƒ¼ãƒãƒ¼
â”‚   â”œâ”€â”€ agui_emitter.py   # AG-UI ã‚¨ãƒŸãƒƒã‚¿ãƒ¼
â”‚   â””â”€â”€ a2ui/             # A2UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”œâ”€â”€ providers/            # çµ±ä¸€ Provider Layerï¼ˆé»’ç›’è¨­è¨ˆï¼‰
â”‚   â”œâ”€â”€ llm_provider.py   # LLM Providerï¼ˆOpenAI/Anthropic/Ollamaï¼‰
â”‚   â”œâ”€â”€ db_provider.py    # DB Providerï¼ˆSupabase/PostgreSQL/SQLiteï¼‰
â”‚   â”œâ”€â”€ vectordb_provider.py  # VectorDB Providerï¼ˆä¸‹è¨˜å‚ç…§ï¼‰
â”‚   â””â”€â”€ embedding_provider.py # Embedding Provider
â””â”€â”€ skills/               # ã‚¹ã‚­ãƒ«è‡ªå‹•é€²åŒ–ã‚·ã‚¹ãƒ†ãƒ 
    â”œâ”€â”€ base.py           # Skill åŸºåº•ã‚¯ãƒ©ã‚¹
    â”œâ”€â”€ loader.py         # ã‚¹ã‚­ãƒ«ãƒ­ãƒ¼ãƒ€ãƒ¼
    â”œâ”€â”€ matcher.py        # ã‚¹ã‚­ãƒ«ãƒãƒƒãƒãƒ£ãƒ¼
    â”œâ”€â”€ generator.py      # ã‚¹ã‚­ãƒ«è‡ªå‹•ç”Ÿæˆ
    â”œâ”€â”€ validator.py      # ã‚¹ã‚­ãƒ«æ¤œè¨¼
    â”œâ”€â”€ persister.py      # ã‚¹ã‚­ãƒ«å›ºåŒ–
    â””â”€â”€ engine.py         # çµ±åˆã‚¨ãƒ³ã‚¸ãƒ³
```

---

## ğŸ” VectorDB Providerï¼ˆé»’ç›’è¨­è¨ˆï¼‰

Agent/ã‚µãƒ¼ãƒ“ã‚¹ã¯ `get_vectordb()` ã®ã¿ã‚’å‘¼ã³å‡ºã—ã€å…·ä½“çš„ãªå®Ÿè£…ã‚’æ„è­˜ã—ã¾ã›ã‚“ã€‚

### å¯¾å¿œãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼

| ã‚¿ã‚¤ãƒ— | ã‚¯ãƒ©ã‚¹ | ç‰¹å¾´ |
|--------|--------|------|
| `faiss` | `FAISSProvider` | ãƒ­ãƒ¼ã‚«ãƒ«é«˜é€Ÿã€GPUå¯¾å¿œ |
| `qdrant` | `QdrantProvider` | æœ¬ç•ªæ¨å¥¨ã€ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ« |
| `weaviate` | `WeaviateProvider` | ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ |
| `supabase` | `SupabaseVectorProvider` | PostgreSQL pgvector |
| `chromadb` | `ChromaDBProvider` | ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ |

### ç’°å¢ƒå¤‰æ•°

```bash
VECTOR_DATABASE_TYPE=qdrant   # "faiss", "qdrant", "weaviate", "supabase", "chromadb"
QDRANT_URL=http://localhost:6333
WEAVIATE_URL=http://localhost:8080
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_KEY=your-key
```

### ä½¿ç”¨ä¾‹

```python
from agentflow import get_vectordb

vdb = get_vectordb()  # ç’°å¢ƒå¤‰æ•°ã‹ã‚‰è‡ªå‹•é¸æŠ
await vdb.connect()
await vdb.add(documents=["doc1"], embeddings=[[...]])
results = await vdb.search(query="query", query_embedding=[...], top_k=5)
```

---

## ğŸ§© æ‹¡å¼µãƒã‚¤ãƒ³ãƒˆ

| æ‹¡å¼µå¯¾è±¡ | æ–¹æ³• |
|---------|------|
| ã‚«ã‚¹ã‚¿ãƒ  Coordinator | `CoordinatorBase` ç¶™æ‰¿ |
| ã‚«ã‚¹ã‚¿ãƒ  Skill | `Skill.load()` ã§ SKILL.md èª­ã¿è¾¼ã¿ |
| ã‚«ã‚¹ã‚¿ãƒ  A2UI | `A2UIComponent` ç¶™æ‰¿ |
| ã‚«ã‚¹ã‚¿ãƒ  Protocol | `ProtocolRegistry` ã«ç™»éŒ² |
| ã‚«ã‚¹ã‚¿ãƒ  VectorDB | `VectorDBProvider` ãƒ—ãƒ­ãƒˆã‚³ãƒ«å®Ÿè£… |

---

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [Skills ã‚¬ã‚¤ãƒ‰](guide-skills.md) - è‡ªå‹•é€²åŒ–ã‚·ã‚¹ãƒ†ãƒ è©³ç´°
- [ãƒ—ãƒ­ãƒˆã‚³ãƒ«è©³ç´°](protocols.md) - MCP/A2A/AG-UI/A2UI ã®ä½¿ç”¨æ–¹æ³•
- [API ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](api.md) - å…¨ API è©³ç´°
- [ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ](quickstart.md) - 10åˆ†ã§å§‹ã‚ã‚‹
- [CLI ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](cli.md) - CLI ã‚³ãƒãƒ³ãƒ‰ä¸€è¦§
