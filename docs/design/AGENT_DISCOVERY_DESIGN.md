# Agent Discovery è¨­è¨ˆæ›¸

> **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
> **æ›´æ–°æ—¥**: 2026-01-15

---

## ğŸ“‹ æ¦‚è¦

å¤§è¦æ¨¡ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆå‘ã‘ã® Agent ç™ºè¦‹ãƒ»ç™»éŒ²æ©Ÿæ§‹ã€‚
Consul/etcd é¢¨ã®ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¡ç”¨ã€‚

### è¨­è¨ˆç›®æ¨™

| ç›®æ¨™ | èª¬æ˜ |
|------|------|
| **å‹•çš„ç™ºè¦‹** | Agent ã®è‡ªå‹•ç™»éŒ²ãƒ»ç™ºè¦‹ |
| **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯** | ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆã«ã‚ˆã‚‹ç”Ÿå­˜ç¢ºèª |
| **èƒ½åŠ›æ¤œç´¢** | ç‰¹å®šèƒ½åŠ›ã‚’æŒã¤ Agent ã®æ¤œç´¢ |
| **ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°** | Agent é¸æŠã®è² è·åˆ†æ•£ |
| **ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼** | éšœå®³æ™‚ã®è‡ªå‹•åˆ‡æ›¿ |

---

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     AgentDiscovery                           â”‚
â”‚              (ç™ºè¦‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ InMemoryRegistryâ”‚    â”‚ RedisRegistry   â”‚  (å°†æ¥)        â”‚
â”‚  â”‚ (é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆç”¨) â”‚    â”‚ (æœ¬ç•ªç”¨)        â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ AgentEntry      â”‚    â”‚ HealthChecker   â”‚                â”‚
â”‚  â”‚ (ç™»éŒ²ã‚¨ãƒ³ãƒˆãƒª)   â”‚    â”‚ (ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯) â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ LoadBalancer    â”‚    â”‚ CapabilityIndex â”‚                â”‚
â”‚  â”‚ (è² è·åˆ†æ•£)       â”‚    â”‚ (èƒ½åŠ›ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹)â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ ã‚³ã‚¢ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

```python
# agentflow/discovery/base.py

from abc import ABC, abstractmethod
from typing import Protocol

class AgentEntry(BaseModel):
    """Agent ç™»éŒ²ã‚¨ãƒ³ãƒˆãƒª."""
    agent_id: str
    name: str
    endpoint: str
    capabilities: list[str]
    status: AgentStatus
    metadata: dict[str, Any]
    registered_at: datetime
    last_heartbeat: datetime
    
class AgentDiscovery(Protocol):
    """Agent ç™ºè¦‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«."""
    
    async def register(self, entry: AgentEntry) -> None:
        """Agent ã‚’ç™»éŒ²."""
        ...
    
    async def unregister(self, agent_id: str) -> None:
        """Agent ã‚’ç™»éŒ²è§£é™¤."""
        ...
    
    async def discover(
        self,
        capability: str | None = None,
        status: AgentStatus | None = None,
    ) -> list[AgentEntry]:
        """Agent ã‚’æ¤œç´¢."""
        ...
    
    async def get(self, agent_id: str) -> AgentEntry | None:
        """Agent ã‚’å–å¾—."""
        ...
    
    async def heartbeat(self, agent_id: str) -> None:
        """ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆã‚’é€ä¿¡."""
        ...
    
    async def select(
        self,
        capability: str,
        strategy: LoadBalanceStrategy = LoadBalanceStrategy.ROUND_ROBIN,
    ) -> AgentEntry | None:
        """è² è·åˆ†æ•£ã§ Agent ã‚’é¸æŠ."""
        ...
```

---

## ğŸ”§ è² è·åˆ†æ•£æˆ¦ç•¥

```python
class LoadBalanceStrategy(str, Enum):
    """è² è·åˆ†æ•£æˆ¦ç•¥."""
    ROUND_ROBIN = "round_robin"      # ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ­ãƒ“ãƒ³
    LEAST_CONNECTIONS = "least_conn" # æœ€å°æ¥ç¶š
    RANDOM = "random"                # ãƒ©ãƒ³ãƒ€ãƒ 
    WEIGHTED = "weighted"            # é‡ã¿ä»˜ã‘
```

---

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
agentflow/discovery/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ base.py           # åŸºåº•ã‚¯ãƒ©ã‚¹ãƒ»ãƒ—ãƒ­ãƒˆã‚³ãƒ«
â”œâ”€â”€ registry.py       # InMemoryRegistry å®Ÿè£…
â”œâ”€â”€ health.py         # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚«ãƒ¼
â”œâ”€â”€ balancer.py       # ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼
â””â”€â”€ index.py          # èƒ½åŠ›ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
```

---

## ğŸ¯ ä½¿ç”¨ä¾‹

```python
from agentflow.discovery import AgentDiscovery, AgentEntry

# ç™»éŒ²
discovery = AgentDiscovery()
await discovery.register(AgentEntry(
    agent_id="agent-001",
    name="ResearchAgent",
    endpoint="http://localhost:8001",
    capabilities=["research", "summarize"],
))

# æ¤œç´¢
agents = await discovery.discover(capability="research")

# é¸æŠï¼ˆè² è·åˆ†æ•£ï¼‰
agent = await discovery.select(capability="research")

# ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆ
await discovery.heartbeat("agent-001")
```

