# Studio UI 操作ガイド

> **使用シナリオ**: コードを書かずに、ビジュアルエディタでワークフローを作成・実行したい

AgentFlow Studio は、ブラウザ上でドラッグ&ドロップでワークフローを作成できるビジュアルエディタです。プログラミング知識がなくても、直感的な操作で AI エージェントのワークフローを構築できます。

---

## 📋 目次

1. [インストール](#インストール)
2. [基本操作](#基本操作)
3. [ワークフロー作成](#ワークフロー作成)
4. [エージェント設定](#エージェント設定)
5. [ワークフロー実行](#ワークフロー実行)
6. [注意事項](#注意事項)
7. [ベストプラクティス](#ベストプラクティス)
8. [トラブルシューティング](#トラブルシューティング)

---

## 📦 インストール

### 前提条件

- Node.js 18.0.0 以上
- npm 9.0.0 以上
- AgentFlow がインストール済み（`agentflow` コマンドが使用可能）

### ステップ 1: Studio のセットアップ

```bash
# プロジェクトルートに移動
cd /path/to/serverlessAIAgents

# Studio ディレクトリに移動
cd studio

# 依存関係をインストール
npm install
```

### ステップ 2: 開発サーバーを起動

```bash
# 開発サーバーを起動
npm run dev
```

ブラウザで `http://localhost:3000` を開きます。

### ステップ 3: バックエンドサーバーの起動（必要に応じて）

Studio はバックエンド API と連携します。バックエンドが必要な場合：

```bash
# 別のターミナルで
cd /path/to/serverlessAIAgents
conda activate agentflow
# バックエンドサーバーを起動（プロジェクトに応じて）
```

---

## 🎯 基本操作

### 画面構成

Studio の画面は3つの主要エリアで構成されています：

1. **サイドバー（左側）**: 利用可能なエージェント一覧
2. **キャンバス（中央）**: ワークフローを編集するエリア
3. **プロパティパネル（右側）**: 選択したノードの設定を編集

### 基本的な操作

| 操作 | 方法 |
|------|------|
| **エージェントを追加** | サイドバーからエージェントをドラッグ&ドロップ |
| **ノードを選択** | ノードをクリック |
| **ノードを移動** | ノードをドラッグ |
| **ノードを削除** | ノードを選択して `Delete` キーを押す |
| **接続を作成** | ノードのハンドル（丸い点）をドラッグして別のノードに接続 |
| **接続を削除** | エッジ（接続線）を選択して `Delete` キーを押す |
| **元に戻す** | `Ctrl/Cmd + Z` |
| **やり直す** | `Ctrl/Cmd + Shift + Z` |
| **保存** | `Ctrl/Cmd + S` |

---

## 🔨 ワークフロー作成

### ステップ 1: 新しいワークフローを作成

1. Studio を開く（`http://localhost:3000`）
2. キャンバスが空の状態から開始

### ステップ 2: エージェントを追加

1. **サイドバー**から使用したいエージェントを見つける
2. エージェントを**ドラッグ**してキャンバスに**ドロップ**
3. エージェントがノードとして表示されます

**例**: テキスト処理エージェントを追加する場合

```
サイドバー: "text-processor" → ドラッグ → キャンバスにドロップ
```

### ステップ 3: エージェントを接続

1. 最初のノードの**出力ハンドル**（下部の丸い点）をクリック
2. マウスをドラッグして、次のノードの**入力ハンドル**（上部の丸い点）に接続
3. 接続線が表示されます

**例**: 2つのエージェントを順次実行する場合

```
text-processor (出力) → data-analyzer (入力)
```

### ステップ 4: ノードの設定

1. ノードを**クリック**して選択
2. **プロパティパネル**（右側）が開きます
3. 設定項目を編集：
   - **入力データ**: JSON 形式で入力
   - **タイムアウト**: 秒単位で設定
   - **有効化**: チェックボックスで有効/無効を切り替え

**入力データの例**:

```json
{
  "message": "Hello, AgentFlow!",
  "operation": "upper"
}
```

---

## ⚙️ エージェント設定

### プロパティパネルの項目

| 項目 | 説明 | 例 |
|------|------|-----|
| **入力データ** | エージェントに渡す JSON データ | `{"text": "hello"}` |
| **タイムアウト** | 実行タイムアウト（秒） | `30` |
| **有効化** | ノードを有効/無効にする | `✓` |

### 設定の保存

- 設定は自動的に保存されます
- `Ctrl/Cmd + S` でワークフロー全体を保存

---

## 🚀 ワークフロー実行

### 方法 1: Studio 内で実行（推奨）

1. ワークフローを構築
2. **実行ボタン**（通常はキャンバス上部のツールバー）をクリック
3. 実行結果が表示されます

### 方法 2: CLI から実行

Studio で作成したワークフローは、CLI からも実行できます：

```bash
# ワークフローを保存した後
agentflow run ./workflows/my-workflow.yaml --input input.json
```

---

## ⚠️ 注意事項

### 1. ブラウザの互換性

- **推奨**: Chrome, Firefox, Edge（最新版）
- **非推奨**: Internet Explorer

### 2. データ形式

- **入力データは JSON 形式**で記述してください
- 不正な JSON はエラーになります

**正しい例**:
```json
{
  "message": "hello",
  "count": 5
}
```

**間違った例**:
```json
{
  "message": "hello",  // 末尾のカンマはエラー
}
```

### 3. ワークフローの保存

- **定期的に保存**してください（`Ctrl/Cmd + S`）
- ブラウザを閉じる前に保存を確認

### 4. パフォーマンス

- **大量のノード**（100個以上）は動作が遅くなる可能性があります
- 複雑なワークフローは分割することを推奨

### 5. バックエンド接続

- バックエンドサーバーが起動していることを確認
- API エラーが発生した場合は、バックエンドのログを確認

---

## 💡 ベストプラクティス

### 1. ワークフローの設計

✅ **良い例**: シンプルで明確な構造

```
入力 → 処理1 → 処理2 → 出力
```

❌ **悪い例**: 複雑で循環的な構造

```
入力 → 処理1 → 処理2 → 処理1（循環）
```

### 2. ノードの命名

- **意味のある名前**を付ける（例: "テキスト処理", "データ分析"）
- デフォルト名（"Node 1"）は避ける

### 3. エラーハンドリング

- **エラー処理ノード**を追加する
- タイムアウトを適切に設定

### 4. テスト

- **小さなワークフロー**から始める
- 各ノードを個別にテストしてから接続

### 5. ドキュメント

- **ワークフローの説明**を追加（プロパティパネル）
- 複雑な設定はコメントで説明

---

## 🔧 トラブルシューティング

### 問題 1: Studio が起動しない

**症状**: `npm run dev` を実行してもブラウザが開かない

**解決方法**:

```bash
# Node.js のバージョンを確認
node --version  # 18.0.0 以上が必要

# 依存関係を再インストール
rm -rf node_modules package-lock.json
npm install

# ポートが使用中の場合
npm run dev -- --port 3001
```

### 問題 2: エージェントが表示されない

**症状**: サイドバーにエージェントが表示されない

**解決方法**:

```bash
# AgentFlow がインストールされているか確認
agentflow list

# バックエンド API が起動しているか確認
curl http://localhost:8000/api/agents
```

### 問題 3: ノードを接続できない

**症状**: ハンドルをドラッグしても接続できない

**解決方法**:

- **入力ハンドル**（上部）と**出力ハンドル**（下部）を確認
- 同じノード同士は接続できません
- 既に接続されている場合は、一度削除して再接続

### 問題 4: 設定が保存されない

**症状**: プロパティパネルで設定を変更しても反映されない

**解決方法**:

- **保存ボタン**をクリック（自動保存が無効な場合）
- ブラウザのコンソールでエラーを確認（F12）
- ワークフローを再読み込み

### 問題 5: 実行エラー

**症状**: ワークフローを実行するとエラーになる

**解決方法**:

1. **入力データの形式**を確認（JSON 形式）
2. **エージェントの設定**を確認（agent.yaml）
3. **バックエンドのログ**を確認
4. **個別のノード**をテスト

---

## 📚 次のステップ

- [CLI 操作ガイド](guide-cli.md) - コマンドラインでの操作
- [コーディングガイド](guide-coding.md) - Python コードでの開発
- [API リファレンス](api.md) - 詳細な API ドキュメント
- [プロトコルガイド](protocols.md) - MCP/A2A/AG-UI の詳細

---

## 🎓 実践例

### 例 1: シンプルなテキスト処理ワークフロー

1. **text-processor** エージェントを追加
2. プロパティパネルで入力データを設定：
   ```json
   {
     "message": "Hello, World!",
     "operation": "upper"
   }
   ```
3. 実行ボタンをクリック
4. 結果を確認

### 例 2: 2段階の処理ワークフロー

1. **text-processor** エージェントを追加
2. **data-analyzer** エージェントを追加
3. text-processor の出力を data-analyzer の入力に接続
4. 各ノードの設定を編集
5. 実行

---

**Studio UI で AI エージェントのワークフローを簡単に作成しましょう！** 🎨

